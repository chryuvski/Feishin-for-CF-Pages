const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./album-artist-list-grid-view-CxWIjNqw.js","./index-qz_z9GmZ.js","./index.css","./use-handle-favorite-DgTaOWZK.js","./album-artist-list-table-view-Mh2nTos4.js","./use-virtual-table-BjhVw3T4.js"])))=>i.map(i=>d[i]);
import{u as ee,d as te,e as m,j as e,r as y,S as Te,_ as se,i as ae,y as fe,z as N,l as je,B as re,E as ge,p,H as C,m as o,o as ne,q as F,h as z,n as O,J as ie,t as w,K as r,M as I,D,O as be,I as Se,bs as Le,U as Z,W as ve,a0 as Oe,a1 as R,s as le,a2 as Pe,bt as Ie,T as Ee,v as ke,a6 as De,P as Fe,L as _,a8 as we,a9 as Be,g as Re,f as _e,k as Me,A as ze,ae as Ne}from"./index-qz_z9GmZ.js";const Ue=y.lazy(()=>se(()=>import("./album-artist-list-grid-view-CxWIjNqw.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(c=>({default:c.AlbumArtistListGridView}))),Ge=y.lazy(()=>se(()=>import("./album-artist-list-table-view-Mh2nTos4.js"),__vite__mapDeps([4,1,2,5]),import.meta.url).then(c=>({default:c.AlbumArtistListTableView}))),Ve=({gridRef:c,itemCount:l,tableRef:n})=>{const{pageKey:u}=ee(),{display:s}=te({key:u}),a=s===m.CARD||s===m.POSTER;return e.jsx(y.Suspense,{fallback:e.jsx(Te,{container:!0}),children:a?e.jsx(Ue,{gridRef:c,itemCount:l}):e.jsx(Ge,{itemCount:l,tableRef:n})})},M={jellyfin:[{defaultOrder:o.ASC,name:C.t("filter.album",{postProcess:"titleCase"}),value:p.ALBUM},{defaultOrder:o.DESC,name:C.t("filter.duration",{postProcess:"titleCase"}),value:p.DURATION},{defaultOrder:o.ASC,name:C.t("filter.name",{postProcess:"titleCase"}),value:p.NAME},{defaultOrder:o.ASC,name:C.t("filter.random",{postProcess:"titleCase"}),value:p.RANDOM},{defaultOrder:o.DESC,name:C.t("filter.recentlyAdded",{postProcess:"titleCase"}),value:p.RECENTLY_ADDED}],navidrome:[{defaultOrder:o.DESC,name:C.t("filter.albumCount",{postProcess:"titleCase"}),value:p.ALBUM_COUNT},{defaultOrder:o.DESC,name:C.t("filter.isFavorited",{postProcess:"titleCase"}),value:p.FAVORITED},{defaultOrder:o.DESC,name:C.t("filter.mostPlayed",{postProcess:"titleCase"}),value:p.PLAY_COUNT},{defaultOrder:o.ASC,name:C.t("filter.name",{postProcess:"titleCase"}),value:p.NAME},{defaultOrder:o.DESC,name:C.t("filter.rating",{postProcess:"titleCase"}),value:p.RATING},{defaultOrder:o.DESC,name:C.t("filter.songCount",{postProcess:"titleCase"}),value:p.SONG_COUNT}],subsonic:[{defaultOrder:o.DESC,name:C.t("filter.albumCount",{postProcess:"titleCase"}),value:p.ALBUM_COUNT},{defaultOrder:o.DESC,name:C.t("filter.isFavorited",{postProcess:"titleCase"}),value:p.FAVORITED},{defaultOrder:o.ASC,name:C.t("filter.name",{postProcess:"titleCase"}),value:p.NAME},{defaultOrder:o.DESC,name:C.t("filter.rating",{postProcess:"titleCase"}),value:p.RATING}]},qe=({gridRef:c,tableRef:l})=>{var $,Y;const{t:n}=ae(),u=fe(),s=N(),{pageKey:a}=ee(),{display:d,filter:h,grid:j,table:g}=te({key:a}),{setDisplayType:E,setFilter:f,setGrid:U,setTable:P,setTablePagination:G}=je(),V=re(),q=d===m.CARD||d===m.POSTER,oe=ge({serverId:s==null?void 0:s.id}),ce=(s==null?void 0:s.type)&&(($=M[s.type].find(t=>t.value===h.sortBy))==null?void 0:$.name)||n("common.unknown",{postProcess:"titleCase"}),ue=t=>{d===m.TABLE||d===m.TABLE_PAGINATED?P({data:{rowHeight:t},key:a}):U({data:{itemSize:t},key:a})},de=t=>{U({data:{itemGap:t},key:a})},K=ne(ue,20),H=y.useCallback(async(t,i,A)=>{const x=F.albumArtists.list((s==null?void 0:s.id)||"",{limit:i,startIndex:t,...A});return await u.fetchQuery(x,async({signal:T})=>z.controller.getAlbumArtistList({apiClientProps:{server:s,signal:T},query:{limit:i,startIndex:t,...A}}),{cacheTime:1e3*60*1})},[u,s]),b=y.useCallback(async t=>{var i,A,x,S,T,J;if(d===m.TABLE||d===m.TABLE_PAGINATED){const L={getRows:async k=>{const W=k.endRow-k.startRow,X=k.startRow,ye=F.albumArtists.list((s==null?void 0:s.id)||"",{limit:W,startIndex:X,...t}),v=await u.fetchQuery(ye,async({signal:xe})=>z.controller.getAlbumArtistList({apiClientProps:{server:s,signal:xe},query:{limit:W,startIndex:X,...t}}),{cacheTime:1e3*60*1});k.successCallback((v==null?void 0:v.items)||[],(v==null?void 0:v.totalRecordCount)||0)},rowCount:void 0};(i=l.current)==null||i.api.setDatasource(L),(A=l.current)==null||A.api.purgeInfiniteCache(),(x=l.current)==null||x.api.ensureIndexVisible(0,"top"),d===m.TABLE_PAGINATED&&G({data:{currentPage:0},key:a})}else{(S=c.current)==null||S.scrollTo(0),(T=c.current)==null||T.resetLoadMoreItemsCache();const L=await H(0,200,t);if(!(L!=null&&L.items))return;(J=c.current)==null||J.setItemData(L.items)}},[d,l,s,u,G,a,c,H]),me=y.useCallback(t=>{var x,S;if(!((x=t.currentTarget)!=null&&x.value)||!(s!=null&&s.type))return;const i=(S=M[s.type].find(T=>T.value===t.currentTarget.value))==null?void 0:S.defaultOrder,A=f({data:{sortBy:t.currentTarget.value,sortOrder:i||o.ASC},itemType:O.ALBUM_ARTIST,key:a});b(A)},[b,a,s==null?void 0:s.type,f]),pe=y.useCallback(t=>{var A;if(!((A=t.currentTarget)!=null&&A.value))return;let i=null;t.currentTarget.value===String(h.musicFolderId)?i=f({data:{musicFolderId:void 0},itemType:O.ALBUM_ARTIST,key:a}):i=f({data:{musicFolderId:t.currentTarget.value},itemType:O.ALBUM_ARTIST,key:a}),b(i)},[h.musicFolderId,b,f,a]),Ce=y.useCallback(()=>{const t=h.sortOrder===o.ASC?o.DESC:o.ASC,i=f({data:{sortOrder:t},itemType:O.ALBUM_ARTIST,key:a});b(i)},[h.sortOrder,b,a,f]),B=y.useCallback(t=>{var i;(i=t.currentTarget)!=null&&i.value&&E({data:t.currentTarget.value,key:a})},[a,E]),he=t=>{var A;const i=g.columns;if(t.length===0)return P({data:{columns:[]},key:a});if(t.length>i.length){const x={column:t[t.length-1],width:100};P({data:{columns:[...i,x]},key:a})}else{const x=i.filter(T=>!t.includes(T.column)),S=i.filter(T=>!x.includes(T));P({data:{columns:S},key:a})}return(A=l.current)==null?void 0:A.api.sizeColumnsToFit()},Ae=t=>{var i;P({data:{autoFit:t.currentTarget.checked},key:a}),t.currentTarget.checked&&((i=l.current)==null||i.api.sizeColumnsToFit())},Q=y.useCallback(()=>{u.invalidateQueries(F.albumArtists.list((s==null?void 0:s.id)||"")),b(h)},[h,b,u,s==null?void 0:s.id]);return e.jsxs(ie,{justify:"space-between",children:[e.jsxs(w,{ref:V.ref,spacing:"sm",w:"100%",children:[e.jsxs(r,{position:"bottom-start",children:[e.jsx(r.Target,{children:e.jsx(I,{compact:!0,fw:"600",size:"md",variant:"subtle",children:ce})}),e.jsx(r.Dropdown,{children:M[s==null?void 0:s.type].map(t=>e.jsx(r.Item,{$isActive:t.value===h.sortBy,onClick:me,value:t.value,children:t.name},`filter-${t.name}`))})]}),e.jsx(D,{orientation:"vertical"}),e.jsx(be,{onToggle:Ce,sortOrder:h.sortOrder}),(s==null?void 0:s.type)===Se.JELLYFIN&&e.jsxs(e.Fragment,{children:[e.jsx(D,{orientation:"vertical"}),e.jsxs(r,{position:"bottom-start",children:[e.jsx(r.Target,{children:e.jsx(I,{compact:!0,fw:"600",size:"md",variant:"subtle",children:V.isMd?"Folder":e.jsx(Le,{size:15})})}),e.jsx(r.Dropdown,{children:(Y=oe.data)==null?void 0:Y.items.map(t=>e.jsx(r.Item,{$isActive:h.musicFolderId===t.id,onClick:pe,value:t.id,children:t.name},`musicFolder-${t.id}`))})]})]}),e.jsx(D,{orientation:"vertical"}),e.jsx(I,{compact:!0,onClick:Q,size:"md",tooltip:{label:n("common.refresh",{postProcess:"titleCase"})},variant:"subtle",children:e.jsx(Z,{size:"1.3rem"})}),e.jsx(D,{orientation:"vertical"}),e.jsxs(r,{position:"bottom-start",children:[e.jsx(r.Target,{children:e.jsx(I,{compact:!0,size:"md",variant:"subtle",children:e.jsx(ve,{size:15})})}),e.jsx(r.Dropdown,{children:e.jsx(r.Item,{icon:e.jsx(Z,{}),onClick:Q,children:n("common.refresh",{postProcess:"titleCase"})})})]})]}),e.jsx(w,{children:e.jsxs(r,{position:"bottom-end",width:425,children:[e.jsx(r.Target,{children:e.jsx(I,{compact:!0,size:"md",variant:"subtle",children:e.jsx(Oe,{size:"1.3rem"})})}),e.jsxs(r.Dropdown,{children:[e.jsx(r.Label,{children:n("table.config.general.displayType",{postProcess:"sentenceCase"})}),e.jsx(r.Item,{$isActive:d===m.CARD,onClick:B,value:m.CARD,children:n("table.config.view.card",{postProcess:"sentenceCase"})}),e.jsx(r.Item,{$isActive:d===m.POSTER,onClick:B,value:m.POSTER,children:n("table.config.view.poster",{postProcess:"sentenceCase"})}),e.jsx(r.Item,{$isActive:d===m.TABLE,onClick:B,value:m.TABLE,children:n("table.config.view.table",{postProcess:"sentenceCase"})}),e.jsx(r.Divider,{}),e.jsx(r.Label,{children:n("table.config.general.itemSize",{postProcess:"sentenceCase"})}),e.jsx(r.Item,{closeMenuOnClick:!1,children:d===m.CARD||d===m.POSTER?e.jsx(R,{defaultValue:j==null?void 0:j.itemSize,max:300,min:150,onChange:K}):e.jsx(R,{defaultValue:g.rowHeight,max:100,min:30,onChange:K})}),q&&e.jsxs(e.Fragment,{children:[e.jsx(r.Label,{children:n("table.config.general.itemGap",{postProcess:"sentenceCase"})}),e.jsx(r.Item,{closeMenuOnClick:!1,children:e.jsx(R,{defaultValue:(j==null?void 0:j.itemGap)||0,max:30,min:0,onChangeEnd:de})})]}),!q&&e.jsxs(e.Fragment,{children:[e.jsx(r.Label,{children:n("table.config.general.tableColumns",{postProcess:"sentenceCase"})}),e.jsx(r.Item,{closeMenuOnClick:!1,component:"div",sx:{cursor:"default"},children:e.jsxs(le,{children:[e.jsx(Pe,{clearable:!0,data:Ie,defaultValue:g==null?void 0:g.columns.map(t=>t.column),onChange:he,width:300}),e.jsxs(w,{position:"apart",children:[e.jsx(Ee,{children:n("table.config.general.autoFitColumns",{postProcess:"sentenceCase"})}),e.jsx(ke,{defaultChecked:g.autoFit,onChange:Ae})]})]})})]})]})]})})]})},Ke=({gridRef:c,itemCount:l,tableRef:n})=>{const{t:u}=ae(),s=N(),a=re(),{filter:d,refresh:h,search:j}=De({gridRef:c,itemCount:l,itemType:O.ALBUM_ARTIST,server:s,tableRef:n}),g=ne(E=>{const f=j(E);h(f)},500);return e.jsxs(le,{ref:a.ref,spacing:0,children:[e.jsx(Fe,{backgroundColor:"var(--titlebar-bg)",children:e.jsxs(ie,{justify:"space-between",w:"100%",children:[e.jsxs(_,{children:[e.jsx(_.Title,{children:u("page.albumArtistList.title",{postProcess:"titleCase"})}),e.jsx(_.Badge,{isLoading:l==null,children:l})]}),e.jsx(w,{children:e.jsx(we,{defaultValue:d.searchTerm,onChange:g,openedWidth:a.isMd?250:a.isSm?200:150})})]})}),e.jsx(Be,{children:e.jsx(qe,{gridRef:c,tableRef:n})})]})},He=c=>{const{options:l,query:n,serverId:u}=c,s=Re(u);return _e({enabled:!!u,queryFn:({signal:a})=>{if(!s)throw new Error("Server not found");return z.controller.getAlbumArtistListCount({apiClientProps:{server:s,signal:a},query:n})},queryKey:F.albumArtists.count(u||"",Object.keys(n).length===0?void 0:n),...l})},$e=()=>{const c=y.useRef(null),l=y.useRef(null),n=O.ALBUM_ARTIST,u=N(),s=Me({key:n}),a=He({options:{cacheTime:1e3*60,staleTime:1e3*60},query:s,serverId:u==null?void 0:u.id}),d=a.data===null?void 0:a.data,h=y.useMemo(()=>({id:void 0,pageKey:n}),[n]);return e.jsx(ze,{children:e.jsxs(Ne.Provider,{value:h,children:[e.jsx(Ke,{gridRef:c,itemCount:d,tableRef:l}),e.jsx(Ve,{gridRef:c,itemCount:d,tableRef:l})]})})};export{$e as default};
//# sourceMappingURL=album-artist-list-route-6iEcyTCB.js.map
