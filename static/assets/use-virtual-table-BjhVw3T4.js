import{y as tt,aP as et,l as at,d as ot,aa as nt,r as i,e as st,aC as it,n as s,q as b,h as I,o as rt,b2 as p,aU as R,aG as lt,cH as ct}from"./index-qz_z9GmZ.js";const U=500,gt=({columnType:M,contextMenu:q,customFilters:H,isClientSide:y,isClientSideSort:B,isSearchParams:c,itemCount:h,itemType:r,pageKey:l,server:S,tableRef:u})=>{const G=tt(),A=et(),{setTable:k,setTablePagination:C}=at(),a=ot({filter:H,key:l}),[g,f]=nt(),Y=g.get("scrollOffset"),D=i.useMemo(()=>({currentPage:Number(g.get("currentPage")),itemsPerPage:Number(g.get("itemsPerPage")),totalItems:Number(g.get("totalItems")),totalPages:Number(g.get("totalPages"))}),[g]),E=Number(c?Y:a.table.scrollOffset)||0,d=a.display===st.TABLE_PAGINATED,V=i.useMemo(()=>it(a.table.columns,!0,M),[M,a.table.columns]),Q=i.useMemo(()=>({lockPinned:!0,lockVisible:!0,resizable:!0}),[]),W=()=>{var t;a.table.autoFit&&((t=u==null?void 0:u.current)==null||t.api.sizeColumnsToFit())},_=i.useMemo(()=>{switch(r){case s.ALBUM:return b.albums.list;case s.ALBUM_ARTIST:return b.albumArtists.list;case s.ARTIST:return b.artists.list;case s.GENRE:return b.genres.list;case s.PLAYLIST:return b.playlists.list;case s.SONG:return b.songs.list;default:return null}},[r]),N=i.useMemo(()=>{switch(r){case s.ALBUM:return I.controller.getAlbumList;case s.ALBUM_ARTIST:return I.controller.getAlbumArtistList;case s.ARTIST:return I.controller.getArtistList;case s.GENRE:return I.controller.getGenreList;case s.PLAYLIST:return I.controller.getPlaylistList;case s.SONG:return I.controller.getSongList;default:return null}},[r]),Z=i.useCallback(t=>{const n={getRows:async e=>{var F;const L=e.endRow-e.startRow,m=e.startRow,T=_((S==null?void 0:S.id)||"",{...a.filter},{limit:L,startIndex:m}),o=await G.fetchQuery(T,async({signal:P})=>await N({apiClientProps:{server:S,signal:P},query:{...a.filter,limit:L,startIndex:m}}));if(B&&(o!=null&&o.items)){const P=ct(o.items,[w=>String(w[a.filter.sortBy]).toLowerCase()],a.filter.sortOrder==="DESC"?["desc"]:["asc"]);e.successCallback(P||[],(o==null?void 0:o.totalRecordCount)||0);return}if(o.totalRecordCount===null){const P=((F=o==null?void 0:o.items)==null?void 0:F.length)===U,w=P?void 0:e.startRow+o.items.length;e.successCallback((o==null?void 0:o.items)||[],P?void 0:w);return}e.successCallback((o==null?void 0:o.items)||[],(o==null?void 0:o.totalRecordCount)||0)},rowCount:void 0};t.api.setDatasource(n),t.api.ensureIndexVisible(E,"top")},[E,_,S,a.filter,G,B,N]),x=i.useCallback(t=>{const{data:n}=t;f(e=>(n.currentPage&&e.set("currentPage",String(n.currentPage)),n.itemsPerPage&&e.set("itemsPerPage",String(n.itemsPerPage)),n.totalItems&&e.set("totalItems",String(n.totalItems)),n.totalPages&&e.set("totalPages",String(n.totalPages)),e),{replace:!0})},[f]),j=i.useCallback(t=>{var n;if(!(!d||!t.api)){try{const e=a.table.pagination.currentPage*a.table.pagination.itemsPerPage;(n=t.api)==null||n.ensureIndexVisible(e,"top")}catch(e){console.log(e)}c?f(e=>(e.set("currentPage",String(t.api.paginationGetCurrentPage())),e.set("itemsPerPage",String(t.api.paginationGetPageSize())),e.set("totalItems",String(t.api.paginationGetRowCount())),e.set("totalPages",String(t.api.paginationGetTotalPages()+1)),e),{replace:!0}):C({data:{itemsPerPage:t.api.paginationGetPageSize(),totalItems:t.api.paginationGetRowCount(),totalPages:t.api.paginationGetTotalPages()+1},key:l})}},[d,c,a.table.pagination.currentPage,a.table.pagination.itemsPerPage,f,C,l]),O=i.useCallback(()=>{const{columnApi:t}=(u==null?void 0:u.current)||{},n=t==null?void 0:t.getAllGridColumns();if(!n)return;const e=a.table.columns,L=[];for(const m of n){const T=e.find(o=>o.column===m.getColDef().colId);T&&L.push({...T,...!a.table.autoFit&&{width:m.getActualWidth()}})}k({data:{columns:L},key:l})},[l,a.table.autoFit,a.table.columns,k,u]),J=rt(O,200),X=t=>{const n=Number((t.top/a.table.rowHeight).toFixed(0));c?f(e=>(e.set("scrollOffset",String(n)),e),{replace:!0}):k({data:{scrollOffset:n},key:l})},z=lt(r,q),$={itemType:r,onCellContextMenu:z},K=i.useMemo(()=>({alwaysShowHorizontalScroll:!0,autoFitColumns:a.table.autoFit,blockLoadDebounceMillis:200,cacheBlockSize:U,getRowId:t=>t.data.id,infiniteInitialRowCount:h||100,pagination:d,paginationAutoPageSize:d,paginationPageSize:a.table.pagination.itemsPerPage||100,paginationProps:d?{pageKey:l,pagination:c?D:a.table.pagination,setPagination:c?x:C}:void 0,rowBuffer:20,rowHeight:a.table.rowHeight||40,rowModelType:y?"clientSide":"infinite",suppressRowDrag:!0}),[y,d,c,h,l,D,a.table.autoFit,a.table.pagination,a.table.rowHeight,x,C]),v=i.useCallback(t=>{switch(r){case s.ALBUM:A(p(R.LIBRARY_ALBUMS_DETAIL,{albumId:t.data.id}));break;case s.ALBUM_ARTIST:A(p(R.LIBRARY_ALBUM_ARTISTS_DETAIL,{albumArtistId:t.data.id}));break;case s.ARTIST:A(p(R.LIBRARY_ARTISTS_DETAIL,{artistId:t.data.id}));break;case s.PLAYLIST:A(p(R.PLAYLISTS_DETAIL_SONGS,{playlistId:t.data.id}));break}},[r,A]);return{columnDefs:V,context:$,defaultColumnDefs:Q,onBodyScrollEnd:X,onCellContextMenu:z,onColumnMoved:O,onColumnResized:J,onGridReady:Z,onGridSizeChange:W,onPaginationChanged:j,onRowDoubleClicked:v,...K}};export{gt as u};
//# sourceMappingURL=use-virtual-table-BjhVw3T4.js.map
