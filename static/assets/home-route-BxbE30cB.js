import{g as q,m as r,F as n,f as h,q as S,h as J,bj as G,i as Q,y as K,r as f,z as k,bk as H,bl as W,I as a,af as P,j as o,S as V,bm as m,n as l,A as z,bn as $,s as X,bo as Z,aU as g,t as v,bp as tt,bq as et,U as st,br as it,L as Y}from"./index-qz_z9GmZ.js";import{u as C,M as at}from"./album-list-query-DRHfuUWa.js";const ot=d=>{const{options:u,query:p,serverId:t}=d,s=q(t),i={limit:5,sortBy:n.RECENTLY_PLAYED,sortOrder:r.ASC,startIndex:0,...p};return h({enabled:!!(s!=null&&s.id),queryFn:({signal:y})=>{if(!s)throw new Error("Server not found");return J.controller.getAlbumList({apiClientProps:{server:s,signal:y},query:i})},queryKey:S.albums.list((s==null?void 0:s.id)||"",i),...u})},rt=(d,u)=>{const{options:p,query:t,serverId:s}=d||{},i=q(s);return h({enabled:!!(i!=null&&i.id),queryFn:({signal:y})=>{if(!i)throw new Error("Server not found");return G.getSongList({apiClientProps:{server:i,signal:y},query:{...t,imageSize:u}})},queryKey:S.songs.list((i==null?void 0:i.id)||"",{...t,imageSize:u}),...p})},ut=()=>{var N,O,b,B,D,x;const{t:d}=Q(),u=K(),p=f.useRef(null),t=k(),s=15,{windowBarStyle:i}=H(),{homeFeature:y,homeItems:_}=W(),T=C({options:{cacheTime:1e3*60,enabled:y,staleTime:1e3*60},query:{limit:20,sortBy:n.RANDOM,sortOrder:r.DESC,startIndex:0},serverId:t==null?void 0:t.id}),M=f.useMemo(()=>{var e,R;return((R=(e=T.data)==null?void 0:e.items)==null?void 0:R.filter(w=>w.imageUrl))??[]},[(N=T.data)==null?void 0:N.items]),L=C({options:{staleTime:1e3*60*5},query:{limit:s,sortBy:n.RANDOM,sortOrder:r.ASC,startIndex:0},serverId:t==null?void 0:t.id}),I=ot({options:{staleTime:0},query:{limit:s,sortBy:n.RECENTLY_PLAYED,sortOrder:r.DESC,startIndex:0},serverId:t==null?void 0:t.id}),c=C({options:{staleTime:1e3*60*5},query:{limit:s,sortBy:n.RECENTLY_ADDED,sortOrder:r.DESC,startIndex:0},serverId:t==null?void 0:t.id}),E=C({options:{enabled:(t==null?void 0:t.type)===a.SUBSONIC||(t==null?void 0:t.type)===a.NAVIDROME,staleTime:1e3*60*5},query:{limit:s,sortBy:n.PLAY_COUNT,sortOrder:r.DESC,startIndex:0},serverId:t==null?void 0:t.id}),A=rt({options:{enabled:(t==null?void 0:t.type)===a.JELLYFIN,staleTime:1e3*60*5},query:{limit:s,sortBy:P.PLAY_COUNT,sortOrder:r.DESC,startIndex:0},serverId:t==null?void 0:t.id},300);if(L.isLoading||I.isLoading||c.isLoading||(t==null?void 0:t.type)===a.JELLYFIN&&A.isLoading||((t==null?void 0:t.type)===a.SUBSONIC||(t==null?void 0:t.type)===a.NAVIDROME)&&E.isLoading)return o.jsx(V,{container:!0});const U={[m.MOST_PLAYED]:{data:(t==null?void 0:t.type)===a.JELLYFIN?(O=A==null?void 0:A.data)==null?void 0:O.items:(b=E==null?void 0:E.data)==null?void 0:b.items,itemType:(t==null?void 0:t.type)===a.JELLYFIN?l.SONG:l.ALBUM,pagination:{itemsPerPage:s},sortBy:(t==null?void 0:t.type)===a.JELLYFIN?P.PLAY_COUNT:n.PLAY_COUNT,sortOrder:r.DESC,title:d("page.home.mostPlayed",{postProcess:"sentenceCase"})},[m.RANDOM]:{data:(B=L==null?void 0:L.data)==null?void 0:B.items,itemType:l.ALBUM,sortBy:n.RANDOM,sortOrder:r.ASC,title:d("page.home.explore",{postProcess:"sentenceCase"})},[m.RECENTLY_ADDED]:{data:(D=c==null?void 0:c.data)==null?void 0:D.items,itemType:l.ALBUM,pagination:{itemsPerPage:s},sortBy:n.RECENTLY_ADDED,sortOrder:r.DESC,title:d("page.home.newlyAdded",{postProcess:"sentenceCase"})},[m.RECENTLY_PLAYED]:{data:(x=I==null?void 0:I.data)==null?void 0:x.items,itemType:l.ALBUM,pagination:{itemsPerPage:s},sortBy:n.RECENTLY_PLAYED,sortOrder:r.DESC,title:d("page.home.recentlyPlayed",{postProcess:"sentenceCase"})}},j=_.filter(e=>!(e.disabled||(t==null?void 0:t.type)===a.JELLYFIN&&e.id===m.RECENTLY_PLAYED)).map(e=>({...U[e.id],uniqueId:e.id})),F=e=>{e.itemType===l.ALBUM&&u.invalidateQueries({exact:!1,queryKey:S.albums.list(t==null?void 0:t.id,{limit:s,sortBy:e.sortBy,sortOrder:e.sortOrder,startIndex:0})}),e.itemType===l.SONG&&u.invalidateQueries({exact:!1,queryKey:S.songs.list(t==null?void 0:t.id,{limit:s,sortBy:e.sortBy,sortOrder:e.sortOrder,startIndex:0})})};return o.jsx(z,{children:o.jsx($,{pageHeaderProps:{backgroundColor:"var(--titlebar-bg)",children:o.jsx(Y,{children:o.jsx(Y.Title,{children:d("page.home.title",{postProcess:"titleCase"})})}),offset:200},ref:p,children:o.jsxs(X,{mb:"5rem",pt:i===it.WEB?"5rem":"3rem",px:"2rem",spacing:"lg",children:[y&&o.jsx(Z,{data:M}),j.map(e=>o.jsx(at,{cardRows:[{property:"name",route:{route:g.LIBRARY_ALBUMS_DETAIL,slugs:[{idProperty:(t==null?void 0:t.type)===a.JELLYFIN&&e.itemType===l.SONG?"albumId":"id",slugProperty:"albumId"}]}},{arrayProperty:"name",property:"albumArtists",route:{route:g.LIBRARY_ALBUM_ARTISTS_DETAIL,slugs:[{idProperty:"id",slugProperty:"albumArtistId"}]}}],data:e.data,itemType:e.itemType,route:{route:g.LIBRARY_ALBUMS_DETAIL,slugs:[{idProperty:(t==null?void 0:t.type)===a.JELLYFIN&&e.itemType===l.SONG?"albumId":"id",slugProperty:"albumId"}]},title:{label:o.jsxs(v,{children:[o.jsx(tt,{order:2,weight:700,children:e.title}),o.jsx(et,{onClick:()=>F(e),children:o.jsx(st,{})})]})},uniqueId:e.uniqueId},`carousel-${e.uniqueId}`))]})})})};export{ut as default};
//# sourceMappingURL=home-route-BxbE30cB.js.map
