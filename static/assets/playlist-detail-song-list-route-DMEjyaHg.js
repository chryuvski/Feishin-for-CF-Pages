import{y as Ie,at as Ue,q,g as ye,h as Q,f as Le,ab as me,au as Ye,av as Ge,aw as ze,z as ie,ax as Ae,r as D,m as i,af as d,ay as Ve,az as He,aA as be,ac as Te,a5 as we,e as Z,aB as $e,aC as Ke,aD as ee,o as Je,aE as Xe,aF as We,aG as Ze,n as ce,j as e,aH as Qe,aI as et,aJ as tt,aK as st,aL as at,I as k,ad as nt,a4 as je,H as p,aM as Ee,i as de,aN as Be,ar as Ne,as as Me,s as pe,aO as ue,x as ot,v as Oe,t as re,M as V,aP as Re,aQ as rt,aR as it,B as lt,aS as ct,aT as Fe,aU as ge,J as dt,K as g,D as ve,O as ut,W as mt,X as Pe,Y as pt,Z as Ct,$ as Pt,aV as St,aW as ft,U as gt,a0 as ht,a1 as xt,a2 as It,ah as yt,T as he,aX as At,P as Tt,L as Se,a as xe,w as jt,aY as Et,aZ as _e,A as Ot,a_ as vt,a$ as Dt,b0 as Lt,b1 as bt,b2 as De}from"./index-qz_z9GmZ.js";import{u as wt}from"./use-current-song-row-styles-AW__6X7H.js";const Bt=C=>{const{options:a}=C||{},r=Ie();return Ue({mutationFn:l=>{const n=ye(l.serverId);if(!n)throw new Error("Server not found");return Q.controller.updatePlaylist({...l,apiClientProps:{server:n}})},onSuccess:(l,n)=>{const{query:t,serverId:s}=n;s&&(r.invalidateQueries(q.playlists.list(s)),t!=null&&t.id&&r.invalidateQueries(q.playlists.detail(s,t.id)))},...a})},Ce=C=>{const{options:a,query:r,serverId:l}=C||{},n=ye(l);return Le({enabled:!!(n!=null&&n.id),queryFn:({signal:t})=>{if(!n)throw new Error("Server not found");return Q.controller.getPlaylistDetail({apiClientProps:{server:n,signal:t},query:r})},queryKey:q.playlists.detail((n==null?void 0:n.id)||"",r.id,r),...a})},ke=C=>{const{options:a,query:r,serverId:l}=C||{},n=ye(l);return Le({enabled:!!n,queryFn:({signal:t})=>{if(!n)throw new Error("Server not found");return Q.controller.getPlaylistSongList({apiClientProps:{server:n,signal:t},query:r})},queryKey:q.playlists.songList((n==null?void 0:n.id)||"",r.id,r),...a})},Nt=({songs:C,tableRef:a})=>{var Y,G,z;const{playlistId:r}=me(),l=Ie(),n=Ye(),t=Ge(),s=ze(),u=ie(),m=Ae(),S=D.useMemo(()=>{var c,o,P,h;return{sortBy:((o=(c=m==null?void 0:m.table.id[r])==null?void 0:c.filter)==null?void 0:o.sortBy)||d.ID,sortOrder:((h=(P=m==null?void 0:m.table.id[r])==null?void 0:P.filter)==null?void 0:h.sortOrder)||i.ASC}},[m==null?void 0:m.table.id,r]),x=Ce({query:{id:r},serverId:u==null?void 0:u.id}),f=Ve(r),A={currentPage:(f==null?void 0:f.currentPage)||0,itemsPerPage:(f==null?void 0:f.itemsPerPage)||100,scrollOffset:(f==null?void 0:f.scrollOffset)||0,totalItems:(f==null?void 0:f.totalItems)||1,totalPages:(f==null?void 0:f.totalPages)||1},y=He(),B=be(),w=Te(),b=we(),E=m.display===Z.TABLE_PAGINATED,L=(u==null?void 0:u.type)===$e.SUBSONIC,v=ke({options:{enabled:!L},query:{id:r,limit:1,startIndex:0},serverId:u==null?void 0:u.id}),H=D.useMemo(()=>Ke(m.table.columns,!1,"generic"),[m.table.columns]),te=D.useCallback(c=>{var o;if(!L){const P={getRows:async h=>{const I=h.endRow-h.startRow,j=h.startRow,T={id:r,limit:I,startIndex:j,...S},R=q.playlists.songList((u==null?void 0:u.id)||"",r,T);if(!u)return;const O=await l.fetchQuery(R,async({signal:N})=>Q.controller.getPlaylistSongList({apiClientProps:{server:u,signal:N},query:T}));h.successCallback((O==null?void 0:O.items)||[],(O==null?void 0:O.totalRecordCount)||0)},rowCount:void 0};c.api.setDatasource(P)}(o=c.api)==null||o.ensureIndexVisible(A.scrollOffset,"top")},[S,L,A.scrollOffset,r,l,u]),se=D.useCallback(async c=>{var P,h;if(!c.nodes.length)return;const o=(P=c.node.data)==null?void 0:P.playlistItemId;if(o&&c.node.rowIndex!==null&&c.overIndex!==c.node.rowIndex)try{await Q.controller.movePlaylistItem({apiClientProps:{server:u},query:{endingIndex:c.overIndex,playlistId:r,startingIndex:c.node.rowIndex+1,trackId:o}}),setTimeout(()=>{l.invalidateQueries({queryKey:q.playlists.songList((u==null?void 0:u.id)||"",r)}),c.api.refreshInfiniteCache()},200)}catch(I){ee.error({message:I.message,title:`Failed to move song ${(h=c.node.data)==null?void 0:h.name} to ${c.overIndex}`})}},[r,l,u]),ae=()=>{var c,o;m.table.autoFit&&((o=(c=a==null?void 0:a.current)==null?void 0:c.api)==null||o.sizeColumnsToFit())},ne=D.useCallback(c=>{var o;if(!(!E||!c.api)){try{const P=A.currentPage*A.itemsPerPage;(o=c.api)==null||o.ensureIndexVisible(P,"top")}catch(P){console.log(P)}y(r,{itemsPerPage:c.api.paginationGetPageSize(),totalItems:c.api.paginationGetRowCount(),totalPages:c.api.paginationGetTotalPages()+1})}},[E,A.currentPage,A.itemsPerPage,r,y]),$=D.useCallback(()=>{const{columnApi:c}=(a==null?void 0:a.current)||{},o=c==null?void 0:c.getAllGridColumns();if(!o)return;const P=m.table.columns,h=[];for(const I of o){const j=P.find(T=>T.column===I.getColDef().colId);j&&h.push({...j,...!m.table.autoFit&&{width:I.getActualWidth()}})}B({columns:h})},[m.table.autoFit,m.table.columns,B,a]),U=Je($,200),M=c=>{const o=Number((c.top/m.table.rowHeight).toFixed(0));y(r,{scrollOffset:o})},oe=D.useMemo(()=>{var c;return(c=x==null?void 0:x.data)!=null&&c.rules?Xe:We},[(Y=x==null?void 0:x.data)==null?void 0:Y.rules]),K=Ze(ce.SONG,oe,{playlistId:r,tableRef:a}),J=c=>{c.data&&(w==null||w({byItemType:{id:[r],type:ce.PLAYLIST},initialSongId:c.data.id,playType:b}))},{rowClassRules:X}=wt({tableRef:a}),W=S.sortBy===d.ID&&!((G=x==null?void 0:x.data)!=null&&G.rules)&&!L;return e.jsxs(e.Fragment,{children:[e.jsx(Qe,{children:e.jsx(et,{alwaysShowHorizontalScroll:!0,autoFitColumns:m.table.autoFit,columnDefs:H,context:{currentSong:s,isFocused:t,itemType:ce.SONG,onCellContextMenu:K,status:n},getRowId:c=>c.data.uniqueId,infiniteInitialRowCount:L?void 0:((z=v.data)==null?void 0:z.totalRecordCount)||100,onBodyScrollEnd:M,onCellContextMenu:K,onColumnMoved:$,onColumnResized:U,onGridReady:te,onGridSizeChanged:ae,onPaginationChanged:ne,onRowDoubleClicked:J,onRowDragEnd:se,pagination:E,paginationAutoPageSize:E,paginationPageSize:A.itemsPerPage||100,ref:a,rowClassRules:X,rowData:C,rowDragEntireRow:W,rowHeight:m.table.rowHeight||40,rowModelType:L?"clientSide":"infinite",shouldUpdateSong:!0},`table-${m.display}-${m.table.rowHeight}-${u==null?void 0:u.id}`)}),E&&e.jsx(tt,{initial:!1,mode:"wait",presenceAffectsLayout:!0,children:m.display===Z.TABLE_PAGINATED&&e.jsx(st,{pageKey:r,pagination:A,setIdPagination:y,tableRef:a})})]})},Mt=({body:C,onCancel:a,query:r,users:l})=>{var y,B,w,b,E,L;const{t:n}=de(),t=Bt({}),s=ie(),u=l==null?void 0:l.map(v=>({label:v.name,value:v.id})),m=Be({initialValues:{_custom:{navidrome:{owner:((B=(y=C==null?void 0:C._custom)==null?void 0:y.navidrome)==null?void 0:B.owner)||"",ownerId:((b=(w=C==null?void 0:C._custom)==null?void 0:w.navidrome)==null?void 0:b.ownerId)||"",rules:void 0,sync:((L=(E=C==null?void 0:C._custom)==null?void 0:E.navidrome)==null?void 0:L.sync)||!1}},comment:(C==null?void 0:C.comment)||"",name:(C==null?void 0:C.name)||"",public:C.public}}),S=m.onSubmit(v=>{t.mutate({body:v,query:r,serverId:s==null?void 0:s.id},{onError:H=>{ee.error({message:H.message,title:n("error.genericError",{postProcess:"sentenceCase"})})},onSuccess:()=>{ee.success({message:n("form.editPlaylist.success",{postProcess:"sentenceCase"})}),a()}})}),x=Ne(s,Me.PUBLIC_PLAYLIST),f=(s==null?void 0:s.type)===k.NAVIDROME&&u,A=!m.values.name||t.isLoading;return e.jsx("form",{onSubmit:S,children:e.jsxs(pe,{children:[e.jsx(ue,{"data-autofocus":!0,label:n("form.createPlaylist.input",{context:"name",postProcess:"titleCase"}),required:!0,...m.getInputProps("name")}),(s==null?void 0:s.type)===k.NAVIDROME&&e.jsx(ue,{label:n("form.createPlaylist.input",{context:"description",postProcess:"titleCase"}),...m.getInputProps("comment")}),f&&e.jsx(ot,{data:u||[],...m.getInputProps("_custom.navidrome.ownerId"),label:n("form.createPlaylist.input",{context:"owner",postProcess:"titleCase"})}),x&&e.jsxs(e.Fragment,{children:[(s==null?void 0:s.type)===k.JELLYFIN&&e.jsx("div",{children:n("form.editPlaylist.publicJellyfinNote",{postProcess:"sentenceCase"})}),e.jsx(Oe,{label:n("form.createPlaylist.input",{context:"public",postProcess:"titleCase"}),...m.getInputProps("public",{type:"checkbox"})})]}),e.jsxs(re,{position:"right",children:[e.jsx(V,{onClick:a,variant:"subtle",children:n("common.cancel",{postProcess:"titleCase"})}),e.jsx(V,{disabled:A,loading:t.isLoading,type:"submit",variant:"filled",children:n("common.save",{postProcess:"titleCase"})})]})]})})},Rt=async C=>{const{playlist:a,server:r}=C,l={sortBy:at.NAME,sortOrder:i.ASC,startIndex:0};if(!r)return;const n=(r==null?void 0:r.type)===k.NAVIDROME?await nt.fetchQuery({queryFn:({signal:t})=>Q.controller.getUserList({apiClientProps:{server:r,signal:t},query:l}),queryKey:q.users.list((r==null?void 0:r.id)||"",l)}).catch(t=>(console.error(t),null)):null;je({children:e.jsx(Mt,{body:{_custom:{navidrome:{owner:(a==null?void 0:a.owner)||void 0,ownerId:(a==null?void 0:a.ownerId)||void 0,rules:(a==null?void 0:a.rules)||void 0,sync:(a==null?void 0:a.sync)||void 0}},comment:(a==null?void 0:a.description)||void 0,genres:a==null?void 0:a.genres,name:a==null?void 0:a.name,public:(a==null?void 0:a.public)||!1},onCancel:Ee,query:{id:a==null?void 0:a.id},users:n==null?void 0:n.items}),title:p.t("form.editPlaylist.title",{postProcess:"titleCase"})})},fe={jellyfin:[{defaultOrder:i.ASC,name:p.t("filter.id",{postProcess:"titleCase"}),value:d.ID},{defaultOrder:i.ASC,name:p.t("filter.album",{postProcess:"titleCase"}),value:d.ALBUM},{defaultOrder:i.ASC,name:p.t("filter.albumArtist",{postProcess:"titleCase"}),value:d.ALBUM_ARTIST},{defaultOrder:i.ASC,name:p.t("filter.artist",{postProcess:"titleCase"}),value:d.ARTIST},{defaultOrder:i.ASC,name:p.t("filter.duration",{postProcess:"titleCase"}),value:d.DURATION},{defaultOrder:i.ASC,name:p.t("filter.playCount",{postProcess:"titleCase"}),value:d.PLAY_COUNT},{defaultOrder:i.ASC,name:p.t("filter.name",{postProcess:"titleCase"}),value:d.NAME},{defaultOrder:i.ASC,name:p.t("filter.random",{postProcess:"titleCase"}),value:d.RANDOM},{defaultOrder:i.ASC,name:p.t("filter.recentlyAdded",{postProcess:"titleCase"}),value:d.RECENTLY_ADDED},{defaultOrder:i.ASC,name:p.t("filter.recentlyPlayed",{postProcess:"titleCase"}),value:d.RECENTLY_PLAYED},{defaultOrder:i.ASC,name:p.t("filter.releaseDate",{postProcess:"titleCase"}),value:d.RELEASE_DATE}],navidrome:[{defaultOrder:i.ASC,name:p.t("filter.id",{postProcess:"titleCase"}),value:d.ID},{defaultOrder:i.ASC,name:p.t("filter.album",{postProcess:"titleCase"}),value:d.ALBUM},{defaultOrder:i.ASC,name:p.t("filter.albumArtist",{postProcess:"titleCase"}),value:d.ALBUM_ARTIST},{defaultOrder:i.ASC,name:p.t("filter.artist",{postProcess:"titleCase"}),value:d.ARTIST},{defaultOrder:i.DESC,name:p.t("filter.bpm",{postProcess:"titleCase"}),value:d.BPM},{defaultOrder:i.ASC,name:p.t("common.channel",{count:2,postProcess:"titleCase"}),value:d.CHANNELS},{defaultOrder:i.ASC,name:p.t("filter.comment",{postProcess:"titleCase"}),value:d.COMMENT},{defaultOrder:i.DESC,name:p.t("filter.duration",{postProcess:"titleCase"}),value:d.DURATION},{defaultOrder:i.DESC,name:p.t("filter.isFavorited",{postProcess:"titleCase"}),value:d.FAVORITED},{defaultOrder:i.ASC,name:p.t("filter.playCount",{postProcess:"titleCase"}),value:d.GENRE},{defaultOrder:i.ASC,name:p.t("filter.name",{postProcess:"titleCase"}),value:d.NAME},{defaultOrder:i.DESC,name:p.t("filter.playCount",{postProcess:"titleCase"}),value:d.PLAY_COUNT},{defaultOrder:i.DESC,name:p.t("filter.rating",{postProcess:"titleCase"}),value:d.RATING},{defaultOrder:i.DESC,name:p.t("filter.recentlyAdded",{postProcess:"titleCase"}),value:d.RECENTLY_ADDED},{defaultOrder:i.DESC,name:p.t("filter.recentlyPlayed",{postProcess:"titleCase"}),value:d.RECENTLY_PLAYED},{defaultOrder:i.DESC,name:p.t("filter.releaseYear",{postProcess:"titleCase"}),value:d.YEAR}],subsonic:[{defaultOrder:i.ASC,name:p.t("filter.id",{postProcess:"titleCase"}),value:d.ID},{defaultOrder:i.ASC,name:p.t("filter.album",{postProcess:"titleCase"}),value:d.ALBUM},{defaultOrder:i.ASC,name:p.t("filter.albumArtist",{postProcess:"titleCase"}),value:d.ALBUM_ARTIST},{defaultOrder:i.ASC,name:p.t("filter.artist",{postProcess:"titleCase"}),value:d.ARTIST},{defaultOrder:i.DESC,name:p.t("filter.duration",{postProcess:"titleCase"}),value:d.DURATION},{defaultOrder:i.DESC,name:p.t("filter.isFavorited",{postProcess:"titleCase"}),value:d.FAVORITED},{defaultOrder:i.ASC,name:p.t("filter.genre",{postProcess:"titleCase"}),value:d.GENRE},{defaultOrder:i.ASC,name:p.t("filter.name",{postProcess:"titleCase"}),value:d.NAME},{defaultOrder:i.DESC,name:p.t("filter.rating",{postProcess:"titleCase"}),value:d.RATING},{defaultOrder:i.DESC,name:p.t("filter.recentlyAdded",{postProcess:"titleCase"}),value:d.RECENTLY_ADDED},{defaultOrder:i.DESC,name:p.t("filter.recentlyPlayed",{postProcess:"titleCase"}),value:d.RECENTLY_PLAYED},{defaultOrder:i.DESC,name:p.t("filter.releaseYear",{postProcess:"titleCase"}),value:d.YEAR}]},Ft=({handleToggleShowQueryBuilder:C,tableRef:a})=>{var J,X,W,Y,G,z,c;const{t:r}=de(),{playlistId:l}=me(),n=Re(),t=Ie(),s=ie(),u=rt(),m=it(),S=Ae(),x={sortBy:((X=(J=S==null?void 0:S.table.id[l])==null?void 0:J.filter)==null?void 0:X.sortBy)||d.ID,sortOrder:((Y=(W=S==null?void 0:S.table.id[l])==null?void 0:W.filter)==null?void 0:Y.sortOrder)||i.ASC},f=Ce({query:{id:l},serverId:s==null?void 0:s.id}),A=(G=f.data)==null?void 0:G.rules,y=Te(),B=lt(),w=ct(),b=be(),E=(s==null?void 0:s.type)&&((z=fe[s.type].find(o=>o.value===x.sortBy))==null?void 0:z.name)||"Unknown",L=o=>{b({rowHeight:o})},v=D.useCallback(async o=>{var P,h,I,j,T;if((s==null?void 0:s.type)!==k.SUBSONIC){const R={getRows:async O=>{const N=O.endRow-O.startRow,F=O.startRow,le=q.playlists.songList((s==null?void 0:s.id)||"",l,{id:l,limit:N,startIndex:F,...o}),_=await t.fetchQuery(le,async({signal:qe})=>Q.controller.getPlaylistSongList({apiClientProps:{server:s,signal:qe},query:{id:l,limit:N,startIndex:F,...o}}),{cacheTime:1e3*60*1});O.successCallback((_==null?void 0:_.items)||[],(_==null?void 0:_.totalRecordCount)||0)},rowCount:void 0};(P=a.current)==null||P.api.setDatasource(R),(h=a.current)==null||h.api.purgeInfiniteCache(),(I=a.current)==null||I.api.ensureIndexVisible(0,"top")}else(j=a.current)==null||j.api.redrawRows(),(T=a.current)==null||T.api.ensureIndexVisible(0,"top");S.display===Z.TABLE_PAGINATED&&w({data:{currentPage:0}})},[a,S.display,s,l,t,w]),H=()=>{t.invalidateQueries(q.albums.list((s==null?void 0:s.id)||"")),v({...S==null?void 0:S.table.id[l].filter,...x})},te=D.useCallback(o=>{var I,j;if(!((I=o.currentTarget)!=null&&I.value)||!(s!=null&&s.type))return;const P=(j=fe[s.type].find(T=>T.value===o.currentTarget.value))==null?void 0:j.defaultOrder,h=m(l,{sortBy:o.currentTarget.value,sortOrder:P||i.ASC});v(h)},[v,l,s==null?void 0:s.type,m]),se=D.useCallback(()=>{const o=x.sortOrder===i.ASC?i.DESC:i.ASC,P=m(l,{sortOrder:o});v(P)},[x.sortOrder,v,l,m]),ae=D.useCallback(o=>{var P;(P=o.currentTarget)!=null&&P.value&&u({detail:{...S,display:o.currentTarget.value}})},[S,u]),ne=o=>{var h;const P=S.table.columns;if(o.length===0)return b({columns:[]});if(o.length>P.length){const I={column:o[o.length-1],width:100};b({columns:[...P,I]})}else{const I=P.filter(T=>!o.includes(T.column)),j=P.filter(T=>!I.includes(T));b({columns:j})}return(h=a.current)==null?void 0:h.api.sizeColumnsToFit()},$=o=>{var P;b({autoFit:o.currentTarget.checked}),o.currentTarget.checked&&((P=a.current)==null||P.api.sizeColumnsToFit())},U=async o=>{y==null||y({byItemType:{id:[l],type:ce.PLAYLIST},playType:o})},M=Fe({}),oe=D.useCallback(()=>{f.data&&(M==null||M.mutate({query:{id:f.data.id},serverId:f.data.serverId},{onError:o=>{ee.error({message:o.message,title:r("error.genericError",{postProcess:"sentenceCase"})})},onSuccess:()=>{n(ge.PLAYLISTS,{replace:!0})}}),Ee())},[M,f.data,n,r]),K=()=>{je({children:e.jsx(At,{onConfirm:oe,children:e.jsx(he,{children:"Are you sure you want to delete this playlist?"})}),title:r("form.deletePlaylist.title",{postProcess:"sentenceCase"})})};return e.jsxs(dt,{justify:"space-between",children:[e.jsxs(re,{ref:B.ref,spacing:"sm",w:"100%",children:[e.jsxs(g,{position:"bottom-start",children:[e.jsx(g.Target,{children:e.jsx(V,{compact:!0,fw:"600",size:"md",tooltip:{label:r("page.playlist.reorder",{postProcess:"sentenceCase"})},variant:"subtle",children:E})}),e.jsx(g.Dropdown,{children:fe[s==null?void 0:s.type].map(o=>e.jsx(g.Item,{$isActive:o.value===x.sortBy,onClick:te,value:o.value,children:o.name},`filter-${o.name}`))})]}),e.jsx(ve,{orientation:"vertical"}),e.jsx(ut,{onToggle:se,sortOrder:x.sortOrder||i.ASC}),e.jsx(ve,{orientation:"vertical"}),e.jsxs(g,{position:"bottom-start",children:[e.jsx(g.Target,{children:e.jsx(V,{compact:!0,fw:"600",size:"md",variant:"subtle",children:e.jsx(mt,{size:"1.3rem"})})}),e.jsxs(g.Dropdown,{children:[e.jsx(g.Item,{icon:e.jsx(pt,{}),onClick:()=>U(Pe.NOW),children:r("player.play",{postProcess:"sentenceCase"})}),e.jsx(g.Item,{icon:e.jsx(Ct,{}),onClick:()=>U(Pe.LAST),children:r("player.addLast",{postProcess:"sentenceCase"})}),e.jsx(g.Item,{icon:e.jsx(Pt,{}),onClick:()=>U(Pe.NEXT),children:r("player.addNext",{postProcess:"sentenceCase"})}),e.jsx(g.Divider,{}),e.jsx(g.Item,{icon:e.jsx(St,{}),onClick:()=>Rt({playlist:f.data,server:s}),children:r("action.editPlaylist",{postProcess:"sentenceCase"})}),e.jsx(g.Item,{icon:e.jsx(ft,{}),onClick:K,children:r("action.deletePlaylist",{postProcess:"sentenceCase"})}),e.jsx(g.Divider,{}),e.jsx(g.Item,{icon:e.jsx(gt,{}),onClick:H,children:r("action.refresh",{postProcess:"sentenceCase"})}),(s==null?void 0:s.type)===k.NAVIDROME&&!A&&e.jsxs(e.Fragment,{children:[e.jsx(g.Divider,{}),e.jsx(g.Item,{$danger:!0,onClick:C,children:r("action.toggleSmartPlaylistEditor",{postProcess:"sentenceCase"})})]})]})]})]}),e.jsx(re,{children:e.jsxs(g,{position:"bottom-end",width:425,children:[e.jsx(g.Target,{children:e.jsx(V,{compact:!0,size:"md",variant:"subtle",children:e.jsx(ht,{size:"1.3rem"})})}),e.jsxs(g.Dropdown,{children:[e.jsx(g.Label,{children:r("table.config.general.displayType",{postProcess:"sentenceCase"})}),e.jsx(g.Item,{$isActive:S.display===Z.TABLE,onClick:ae,value:Z.TABLE,children:"Table"}),e.jsx(g.Divider,{}),e.jsx(g.Label,{children:r("table.config.general.itemSize",{postProcess:"sentenceCase"})}),e.jsx(g.Item,{closeMenuOnClick:!1,children:e.jsx(xt,{defaultValue:S.table.rowHeight,label:null,max:100,min:25,onChangeEnd:L})}),(S.display===Z.TABLE||S.display===Z.TABLE_PAGINATED)&&e.jsxs(e.Fragment,{children:[e.jsx(g.Label,{children:"Table Columns"}),e.jsx(g.Item,{closeMenuOnClick:!1,component:"div",sx:{cursor:"default"},children:e.jsxs(pe,{children:[e.jsx(It,{clearable:!0,data:yt,defaultValue:(c=S.table)==null?void 0:c.columns.map(o=>o.column),onChange:ne,width:300}),e.jsxs(re,{position:"apart",children:[e.jsx(he,{children:"Auto Fit Columns"}),e.jsx(Oe,{defaultChecked:S.table.autoFit,onChange:$})]})]})})]})]})]})})]})},_t=({handleToggleShowQueryBuilder:C,itemCount:a,tableRef:r})=>{var f,A;const{t:l}=de(),{playlistId:n}=me(),t=ie(),s=Ce({query:{id:n},serverId:t==null?void 0:t.id}),u=Te(),m=async y=>{u==null||u({byItemType:{id:[n],type:ce.PLAYLIST},playType:y})},S=we();if(s.isLoading)return null;const x=(f=s==null?void 0:s.data)==null?void 0:f.rules;return e.jsxs(pe,{spacing:0,children:[e.jsx(Tt,{backgroundColor:"var(--titlebar-bg)",children:e.jsxs(Se,{children:[e.jsx(Se.PlayButton,{onClick:()=>m(S)}),e.jsx(Se.Title,{children:(A=s==null?void 0:s.data)==null?void 0:A.name}),e.jsx(xe,{fw:"600",px:"1rem",py:"0.3rem",radius:"sm",children:a??e.jsx(jt,{})}),x&&e.jsx(Et,{size:"lg",children:l("entity.smartPlaylist")})]})}),e.jsx(xe,{p:"1rem",children:e.jsx(Ft,{handleToggleShowQueryBuilder:C,tableRef:r})})]})},kt=({body:C,onCancel:a,onSuccess:r,serverId:l})=>{var f;const{t:n}=de(),t=_e({}),s=ie(),u=Be({initialValues:{_custom:{navidrome:{rules:void 0,...(f=C==null?void 0:C._custom)==null?void 0:f.navidrome}},comment:C.comment||"",name:C.name||"",public:C.public}}),m=u.onSubmit(A=>{t.mutate({body:A,serverId:l},{onError:y=>{ee.error({message:y.message,title:n("error.genericError",{postProcess:"sentenceCase"})})},onSuccess:y=>{ee.success({message:n("form.createPlaylist.success",{postProcess:"sentenceCase"})}),r(y),a()}})}),S=Ne(s,Me.PUBLIC_PLAYLIST),x=!u.values.name||t.isLoading;return e.jsx("form",{onSubmit:m,children:e.jsxs(pe,{children:[e.jsx(ue,{"data-autofocus":!0,label:n("form.createPlaylist.input",{context:"name",postProcess:"titleCase"}),required:!0,...u.getInputProps("name")}),(s==null?void 0:s.type)===k.NAVIDROME&&e.jsx(ue,{label:n("form.createPlaylist.input",{context:"description",postProcess:"titleCase"}),...u.getInputProps("comment")}),S&&e.jsx(Oe,{label:n("form.createPlaylist.input",{context:"public",postProcess:"titleCase"}),...u.getInputProps("public",{type:"checkbox"})}),e.jsxs(re,{position:"right",children:[e.jsx(V,{onClick:a,variant:"subtle",children:n("common.cancel",{postProcess:"titleCase"})}),e.jsx(V,{disabled:x,loading:t.isLoading,type:"submit",variant:"filled",children:n("common.save",{postProcess:"titleCase"})})]})]})})},Yt=()=>{var te,se,ae,ne,$,U,M,oe,K,J,X,W,Y,G,z,c;const{t:C}=de(),a=Re(),r=D.useRef(null),{playlistId:l}=me(),n=ie(),t=Ce({query:{id:l},serverId:n==null?void 0:n.id}),s=_e({}),u=Fe({}),m=(o,P)=>{var I,j,T,R,O,N,F;const h={...o,limit:P.limit||void 0,order:P.sortOrder||"desc",sort:P.sortBy||"dateAdded"};t!=null&&t.data&&s.mutate({body:{_custom:{navidrome:{owner:((I=t==null?void 0:t.data)==null?void 0:I.owner)||"",ownerId:((j=t==null?void 0:t.data)==null?void 0:j.ownerId)||"",rules:h,sync:((T=t==null?void 0:t.data)==null?void 0:T.sync)||!1}},comment:((R=t==null?void 0:t.data)==null?void 0:R.description)||"",name:(O=t==null?void 0:t.data)==null?void 0:O.name,public:((N=t==null?void 0:t.data)==null?void 0:N.public)||!1},serverId:(F=t==null?void 0:t.data)==null?void 0:F.serverId},{onSuccess:le=>{var _;ee.success({message:"Playlist has been saved"}),a(De(ge.PLAYLISTS_DETAIL_SONGS,{playlistId:(le==null?void 0:le.id)||""}),{replace:!0}),u.mutate({query:{id:l},serverId:(_=t==null?void 0:t.data)==null?void 0:_.serverId})}})},S=(o,P)=>{var h,I,j,T,R,O,N;je({children:e.jsx(kt,{body:{_custom:{navidrome:{owner:((h=t==null?void 0:t.data)==null?void 0:h.owner)||"",ownerId:((I=t==null?void 0:t.data)==null?void 0:I.ownerId)||"",rules:{...o,limit:P.limit||void 0,order:P.sortOrder||"desc",sort:P.sortBy||"dateAdded"},sync:((j=t==null?void 0:t.data)==null?void 0:j.sync)||!1}},comment:((T=t==null?void 0:t.data)==null?void 0:T.description)||"",name:(R=t==null?void 0:t.data)==null?void 0:R.name,public:((O=t==null?void 0:t.data)==null?void 0:O.public)||!1},onCancel:Ee,onSuccess:F=>a(De(ge.PLAYLISTS_DETAIL_SONGS,{playlistId:(F==null?void 0:F.id)||""})),serverId:(N=t==null?void 0:t.data)==null?void 0:N.serverId}),title:C("common.saveAs",{postProcess:"sentenceCase"})})},x=!(t!=null&&t.isLoading)&&((te=t==null?void 0:t.data)==null?void 0:te.rules)&&(n==null?void 0:n.type)===k.NAVIDROME,[f,A]=D.useState(!1),[y,B]=D.useState(!1),w=()=>{B(o=>!o)},b=()=>{A(o=>!o),B(!0)},E=Ae(),L={sortBy:((ae=(se=E==null?void 0:E.table.id[l])==null?void 0:se.filter)==null?void 0:ae.sortBy)||d.ID,sortOrder:(($=(ne=E==null?void 0:E.table.id[l])==null?void 0:ne.filter)==null?void 0:$.sortOrder)||i.ASC},v=ke({query:{id:l,limit:1,startIndex:0,...L},serverId:n==null?void 0:n.id}),H=((U=v.data)==null?void 0:U.totalRecordCount)||((M=v.data)==null?void 0:M.items.length);return e.jsxs(Ot,{children:[e.jsx(_t,{handleToggleShowQueryBuilder:b,itemCount:H,tableRef:r}),(x||f)&&e.jsx(vt,{children:e.jsxs(xe,{h:"100%",mah:"35vh",w:"100%",children:[e.jsxs(re,{p:"1rem",children:[e.jsx(V,{compact:!0,onClick:w,variant:"default",children:y?e.jsx(Dt,{size:20}):e.jsx(Lt,{size:20})}),e.jsx(he,{children:"Query Editor"})]}),y&&e.jsx(bt,{isSaving:s==null?void 0:s.isLoading,limit:(K=(oe=t==null?void 0:t.data)==null?void 0:oe.rules)==null?void 0:K.limit,onSave:m,onSaveAs:S,playlistId:l,query:(J=t==null?void 0:t.data)==null?void 0:J.rules,sortBy:((W=(X=t==null?void 0:t.data)==null?void 0:X.rules)==null?void 0:W.sort)||d.ALBUM,sortOrder:((G=(Y=t==null?void 0:t.data)==null?void 0:Y.rules)==null?void 0:G.order)||"asc"},JSON.stringify((z=t==null?void 0:t.data)==null?void 0:z.rules))]})}),e.jsx(Nt,{songs:(n==null?void 0:n.type)===k.SUBSONIC?(c=v.data)==null?void 0:c.items:void 0,tableRef:r})]},`playlist-detail-songList-${l}`)};export{Yt as default};
//# sourceMappingURL=playlist-detail-song-list-route-DMEjyaHg.js.map
