import{cI as Xt,r as Fe,cj as Wt,j as Ut,bI as Vt}from"./index-qz_z9GmZ.js";/**!
 * audioMotion-analyzer
 * High-resolution real-time graphic audio spectrum analyzer JS module
 *
 * @version 4.5.0
 * @author  Henrique Avila Vianna <hvianna@gmail.com> <https://henriquevianna.com>
 * @license AGPL-3.0-or-later
 */const Yt="4.5.0",ct=Math.PI,De=2*ct,nt=ct/2,pt=8.17579892,mt="dual-combined",Ye="dual-horizontal",ye="single",Re="dual-vertical",Lt="bar-index",Rt="bar-level",Qe="gradient",wt=60,yt="click",$t="fullscreenchange",Ft="resize",jt="#111",Dt="",At="A",Et="B",St="C",bt="D",Ct="468",$e="sans-serif",Qt="#0f0",Kt="#7f7f7f22",Ne=10,vt="create",xt="fschange",Jt="lores",Zt=Ft,rt="user",ei="#000c",Tt="#fff",ti="#4f4",Bt="#888",ii="#555",ot="bark",Pe="linear",Me="log",lt="mel",It=["#a35","#c66","#e94","#ed0","#9d5","#4d8","#2cb","#0bc","#09c","#36b"],Nt=[["classic",{colorStops:["red",{color:"yellow",level:.85,pos:.6},{color:"lime",level:.475}]}],["prism",{colorStops:It}],["rainbow",{dir:"h",colorStops:["#817",...It,"#639"]}],["orangered",{bgColor:"#3e2f29",colorStops:["OrangeRed"]}],["steelblue",{bgColor:"#222c35",colorStops:["SteelBlue"]}]],Xe={alphaBars:!1,ansiBands:!1,barSpace:.1,bgAlpha:.7,channelLayout:ye,colorMode:Qe,fadePeaks:!1,fftSize:8192,fillAlpha:1,frequencyScale:Me,gradient:Nt[0][0],gravity:3.8,height:void 0,ledBars:!1,linearAmplitude:!1,linearBoost:1,lineWidth:0,loRes:!1,lumiBars:!1,maxDecibels:-25,maxFPS:0,maxFreq:22e3,minDecibels:-85,minFreq:20,mirror:0,mode:0,noteLabels:!1,outlineBars:!1,overlay:!1,peakFadeTime:750,peakHoldTime:500,peakLine:!1,radial:!1,radialInvert:!1,radius:.3,reflexAlpha:.15,reflexBright:1,reflexFit:!0,reflexRatio:0,roundBars:!1,showBgColor:!0,showFPS:!1,showPeaks:!0,showScaleX:!0,showScaleY:!1,smoothing:.5,spinSpeed:0,splitGradient:!1,start:!0,trueLeds:!1,useCanvas:!0,volume:1,weightingFilter:Dt,width:void 0},si=["ERR_AUDIO_CONTEXT_FAIL","Could not create audio context. Web Audio API not supported?"],ai=["ERR_INVALID_AUDIO_CONTEXT","Provided audio context is not valid"],ni=["ERR_UNKNOWN_GRADIENT","Unknown gradient"],ht=["ERR_FREQUENCY_TOO_LOW","Frequency values must be >= 1"],ri=["ERR_INVALID_MODE","Invalid mode"],oi=["ERR_REFLEX_OUT_OF_RANGE","Reflex ratio must be >= 0 and < 1"],li=["ERR_INVALID_AUDIO_SOURCE","Audio source must be an instance of HTMLMediaElement or AudioNode"],hi=["ERR_GRADIENT_INVALID_NAME","Gradient name must be a non-empty string"],ci=["ERR_GRADIENT_NOT_AN_OBJECT","Gradient options must be an object"],di=["ERR_GRADIENT_MISSING_COLOR","Gradient colorStops must be a non-empty array"];class he extends Error{constructor(e,i){const[s,n]=e;super(n+(i!==void 0?`: ${i}`:"")),this.name="AudioMotionError",this.code=s}}const Ot=(Z,e)=>console.warn(`${Z} is deprecated. Use ${e} instead.`),kt=Z=>{for(const e in Z)return!1;return!0},je=(Z,e,i="toLowerCase")=>e[Math.max(0,e.indexOf((""+Z)[i]()))],fi=(Z,e,i,s,n)=>e+(s-e)*(n-Z)/(i-Z);Array.prototype.findLastIndex||(Array.prototype.findLastIndex=function(Z){let e=this.length;for(;e-- >0;)if(Z(this[e]))return e;return-1});class _i{constructor(e,i={}){this._ready=!1,this._aux={},this._canvasGradients=[],this._destroyed=!1,this._energy={val:0,peak:0,hold:0},this._flg={},this._fps=0,this._gradients={},this._last=0,this._outNodes=[],this._ownContext=!1,this._selectedGrads=[],this._sources=[],e instanceof Element||(kt(i)&&!kt(e)&&(i=e),e=null),this._ownCanvas=!(i.canvas instanceof HTMLCanvasElement);const s=this._ownCanvas?document.createElement("canvas"):i.canvas;s.style="max-width: 100%;",this._ctx=s.getContext("2d");for(const[g,x]of Nt)this.registerGradient(g,x);this._container=e||!this._ownCanvas&&s.parentElement||document.body,this._defaultWidth=this._container.clientWidth||640,this._defaultHeight=this._container.clientHeight||270;let n;if(!(i.source&&(n=i.source.context))){if(!(n=i.audioCtx))try{n=new(window.AudioContext||window.webkitAudioContext),this._ownContext=!0}catch{throw new he(si)}}if(!n.createGain)throw new he(ai);const c=this._analyzer=[n.createAnalyser(),n.createAnalyser()],r=this._splitter=n.createChannelSplitter(2),o=this._merger=n.createChannelMerger(2);this._input=n.createGain(),this._output=n.createGain(),i.source&&this.connectInput(i.source);for(const g of[0,1])r.connect(c[g],g);o.connect(this._output),i.connectSpeakers!==!1&&this.connectOutput();for(const g of["_scaleX","_scaleR"])this[g]=document.createElement("canvas").getContext("2d");this._fsEl=i.fsElement||s;const l=()=>{this._fsTimeout||(this._fsTimeout=window.setTimeout(()=>{this._fsChanging||(this._setCanvas(Zt),this._fsTimeout=0)},wt))};window.ResizeObserver&&(this._observer=new ResizeObserver(l),this._observer.observe(this._container)),this._controller=new AbortController;const p=this._controller.signal;window.addEventListener(Ft,l,{signal:p}),s.addEventListener($t,()=>{this._fsChanging=!0,this._fsTimeout&&window.clearTimeout(this._fsTimeout),this._setCanvas(xt),this._fsTimeout=window.setTimeout(()=>{this._fsChanging=!1,this._fsTimeout=0},wt)},{signal:p});const _=()=>{n.state=="suspended"&&n.resume(),window.removeEventListener(yt,_)};window.addEventListener(yt,_),document.addEventListener("visibilitychange",()=>{document.visibilityState!="hidden"&&(this._frames=0,this._time=performance.now())},{signal:p}),this._setProps(i,!0),this.useCanvas&&this._ownCanvas&&this._container.appendChild(s),this._ready=!0,this._setCanvas(vt)}get alphaBars(){return this._alphaBars}set alphaBars(e){this._alphaBars=!!e,this._calcBars()}get ansiBands(){return this._ansiBands}set ansiBands(e){this._ansiBands=!!e,this._calcBars()}get barSpace(){return this._barSpace}set barSpace(e){this._barSpace=+e||0,this._calcBars()}get channelLayout(){return this._chLayout}set channelLayout(e){this._chLayout=je(e,[ye,Ye,Re,mt]),this._input.disconnect(),this._input.connect(this._chLayout!=ye?this._splitter:this._analyzer[0]),this._analyzer[0].disconnect(),this._outNodes.length&&this._analyzer[0].connect(this._chLayout!=ye?this._merger:this._output),this._calcBars(),this._makeGrad()}get colorMode(){return this._colorMode}set colorMode(e){this._colorMode=je(e,[Qe,Lt,Rt])}get fadePeaks(){return this._fadePeaks}set fadePeaks(e){this._fadePeaks=!!e}get fftSize(){return this._analyzer[0].fftSize}set fftSize(e){for(const s of[0,1])this._analyzer[s].fftSize=e;const i=this._analyzer[0].frequencyBinCount;this._fftData=[new Float32Array(i),new Float32Array(i)],this._calcBars()}get frequencyScale(){return this._frequencyScale}set frequencyScale(e){this._frequencyScale=je(e,[Me,ot,lt,Pe]),this._calcBars()}get gradient(){return this._selectedGrads[0]}set gradient(e){this._setGradient(e)}get gradientLeft(){return this._selectedGrads[0]}set gradientLeft(e){this._setGradient(e,0)}get gradientRight(){return this._selectedGrads[1]}set gradientRight(e){this._setGradient(e,1)}get gravity(){return this._gravity}set gravity(e){this._gravity=e>0?+e:this._gravity||Xe.gravity}get height(){return this._height}set height(e){this._height=e,this._setCanvas(rt)}get ledBars(){return this._showLeds}set ledBars(e){this._showLeds=!!e,this._calcBars()}get linearAmplitude(){return this._linearAmplitude}set linearAmplitude(e){this._linearAmplitude=!!e}get linearBoost(){return this._linearBoost}set linearBoost(e){this._linearBoost=e>=1?+e:1}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth=+e||0}get loRes(){return this._loRes}set loRes(e){this._loRes=!!e,this._setCanvas(Jt)}get lumiBars(){return this._lumiBars}set lumiBars(e){this._lumiBars=!!e,this._calcBars(),this._makeGrad()}get maxDecibels(){return this._analyzer[0].maxDecibels}set maxDecibels(e){for(const i of[0,1])this._analyzer[i].maxDecibels=e}get maxFPS(){return this._maxFPS}set maxFPS(e){this._maxFPS=e<0?0:+e||0}get maxFreq(){return this._maxFreq}set maxFreq(e){if(e<1)throw new he(ht);this._maxFreq=Math.min(e,this.audioCtx.sampleRate/2),this._calcBars()}get minDecibels(){return this._analyzer[0].minDecibels}set minDecibels(e){for(const i of[0,1])this._analyzer[i].minDecibels=e}get minFreq(){return this._minFreq}set minFreq(e){if(e<1)throw new he(ht);this._minFreq=+e,this._calcBars()}get mirror(){return this._mirror}set mirror(e){this._mirror=Math.sign(e)|0,this._calcBars(),this._makeGrad()}get mode(){return this._mode}set mode(e){const i=e|0;if(i>=0&&i<=10&&i!=9)this._mode=i,this._calcBars(),this._makeGrad();else throw new he(ri,e)}get noteLabels(){return this._noteLabels}set noteLabels(e){this._noteLabels=!!e,this._createScales()}get outlineBars(){return this._outlineBars}set outlineBars(e){this._outlineBars=!!e,this._calcBars()}get peakFadeTime(){return this._peakFadeTime}set peakFadeTime(e){this._peakFadeTime=e>=0?+e:this._peakFadeTime||Xe.peakFadeTime}get peakHoldTime(){return this._peakHoldTime}set peakHoldTime(e){this._peakHoldTime=+e||0}get peakLine(){return this._peakLine}set peakLine(e){this._peakLine=!!e}get radial(){return this._radial}set radial(e){this._radial=!!e,this._calcBars(),this._makeGrad()}get radialInvert(){return this._radialInvert}set radialInvert(e){this._radialInvert=!!e,this._calcBars(),this._makeGrad()}get radius(){return this._radius}set radius(e){this._radius=+e||0,this._calcBars(),this._makeGrad()}get reflexRatio(){return this._reflexRatio}set reflexRatio(e){if(e=+e||0,e<0||e>=1)throw new he(oi);this._reflexRatio=e,this._calcBars(),this._makeGrad()}get roundBars(){return this._roundBars}set roundBars(e){this._roundBars=!!e,this._calcBars()}get smoothing(){return this._analyzer[0].smoothingTimeConstant}set smoothing(e){for(const i of[0,1])this._analyzer[i].smoothingTimeConstant=e}get spinSpeed(){return this._spinSpeed}set spinSpeed(e){e=+e||0,(this._spinSpeed===void 0||e==0)&&(this._spinAngle=-nt),this._spinSpeed=e}get splitGradient(){return this._splitGradient}set splitGradient(e){this._splitGradient=!!e,this._makeGrad()}get stereo(){return Ot("stereo","channelLayout"),this._chLayout!=ye}set stereo(e){Ot("stereo","channelLayout"),this.channelLayout=e?Re:ye}get trueLeds(){return this._trueLeds}set trueLeds(e){this._trueLeds=!!e}get volume(){return this._output.gain.value}set volume(e){this._output.gain.value=e}get weightingFilter(){return this._weightingFilter}set weightingFilter(e){this._weightingFilter=je(e,[Dt,At,Et,St,bt,Ct],"toUpperCase")}get width(){return this._width}set width(e){this._width=e,this._setCanvas(rt)}get audioCtx(){return this._input.context}get canvas(){return this._ctx.canvas}get canvasCtx(){return this._ctx}get connectedSources(){return this._sources}get connectedTo(){return this._outNodes}get fps(){return this._fps}get fsHeight(){return this._fsHeight}get fsWidth(){return this._fsWidth}get isAlphaBars(){return this._flg.isAlpha}get isBandsMode(){return this._flg.isBands}get isDestroyed(){return this._destroyed}get isFullscreen(){return this._fsEl&&(document.fullscreenElement||document.webkitFullscreenElement)===this._fsEl}get isLedBars(){return this._flg.isLeds}get isLumiBars(){return this._flg.isLumi}get isOctaveBands(){return this._flg.isOctaves}get isOn(){return!!this._runId}get isOutlineBars(){return this._flg.isOutline}get pixelRatio(){return this._pixelRatio}get isRoundBars(){return this._flg.isRound}static get version(){return Yt}connectInput(e){const i=e instanceof HTMLMediaElement;if(!(i||e.connect))throw new he(li);const s=i?this.audioCtx.createMediaElementSource(e):e;return this._sources.includes(s)||(s.connect(this._input),this._sources.push(s)),s}connectOutput(e=this.audioCtx.destination){if(!this._outNodes.includes(e)&&(this._output.connect(e),this._outNodes.push(e),this._outNodes.length==1))for(const i of[0,1])this._analyzer[i].connect(this._chLayout==ye&&!i?this._output:this._merger,0,i)}destroy(){if(!this._ready)return;const{audioCtx:e,canvas:i,_controller:s,_input:n,_merger:c,_observer:r,_ownCanvas:o,_ownContext:l,_splitter:p}=this;this._destroyed=!0,this._ready=!1,this.stop(),s.abort(),r&&r.disconnect(),this.onCanvasResize=null,this.onCanvasDraw=null,this._fsEl=null,this.disconnectInput(),this.disconnectOutput(),n.disconnect(),p.disconnect(),c.disconnect(),l&&e.close(),o&&i.remove(),this._calcBars()}disconnectInput(e,i){e?Array.isArray(e)||(e=[e]):e=Array.from(this._sources);for(const s of e){const n=this._sources.indexOf(s);if(i&&s.mediaStream)for(const c of s.mediaStream.getAudioTracks())c.stop();n>=0&&(s.disconnect(this._input),this._sources.splice(n,1))}}disconnectOutput(e){if(!(e&&!this._outNodes.includes(e))&&(this._output.disconnect(e),this._outNodes=e?this._outNodes.filter(i=>i!==e):[],this._outNodes.length==0))for(const i of[0,1])this._analyzer[i].disconnect()}getBars(){return Array.from(this._bars,({posX:e,freq:i,freqLo:s,freqHi:n,hold:c,peak:r,value:o})=>({posX:e,freq:i,freqLo:s,freqHi:n,hold:c,peak:r,value:o}))}getEnergy(e,i){if(e===void 0)return this._energy.val;if(e!=+e){if(e=="peak")return this._energy.peak;const o={bass:[20,250],lowMid:[250,500],mid:[500,2e3],highMid:[2e3,4e3],treble:[4e3,16e3]};if(!o[e])return null;[e,i]=o[e]}const s=this._freqToBin(e),n=i?this._freqToBin(i):s,c=this._chLayout==ye?1:2;let r=0;for(let o=0;o<c;o++)for(let l=s;l<=n;l++)r+=this._normalizedB(this._fftData[o][l]);return r/(n-s+1)/c}getOptions(e){Array.isArray(e)||(e=[e]);let i={};for(const s of Object.keys(Xe))e.includes(s)||(s=="gradient"&&this.gradientLeft!=this.gradientRight?(i.gradientLeft=this.gradientLeft,i.gradientRight=this.gradientRight):s!="start"&&(i[s]=this[s]));return i}registerGradient(e,i){if(typeof e!="string"||e.trim().length==0)throw new he(hi);if(typeof i!="object")throw new he(ci);const{colorStops:s}=i;if(!Array.isArray(s)||!s.length)throw new he(di);const n=s.length,c=r=>+r!=r||r<0||r>1;s.forEach((r,o)=>{const l=o/Math.max(1,n-1);typeof r!="object"?s[o]={pos:l,color:r}:c(r.pos)&&(r.pos=l),c(r.level)&&(s[o].level=1-o/n)}),s.sort((r,o)=>r.level<o.level?1:r.level>o.level?-1:0),s[0].level=1,this._gradients[e]={bgColor:i.bgColor||jt,dir:i.dir,colorStops:s},this._selectedGrads.includes(e)&&this._makeGrad()}setCanvasSize(e,i){this._width=e,this._height=i,this._setCanvas(rt)}setFreqRange(e,i){if(e<1||i<1)throw new he(ht);this._minFreq=Math.min(e,i),this.maxFreq=Math.max(e,i)}setLedParams(e){let i,s,n;e&&(i=e.maxLeds|0,s=+e.spaceV,n=+e.spaceH),this._ledParams=i>0&&s>0&&n>=0?[i,s,n]:void 0,this._calcBars()}setOptions(e){this._setProps(e)}setSensitivity(e,i){for(const s of[0,1])this._analyzer[s].minDecibels=Math.min(e,i),this._analyzer[s].maxDecibels=Math.max(e,i)}start(){this.toggleAnalyzer(!0)}stop(){this.toggleAnalyzer(!1)}toggleAnalyzer(e){const i=this.isOn;return e===void 0&&(e=!i),i&&!e?(cancelAnimationFrame(this._runId),this._runId=0):!i&&e&&!this._destroyed&&(this._frames=0,this._time=performance.now(),this._runId=requestAnimationFrame(s=>this._draw(s))),this.isOn}toggleFullscreen(){if(this.isFullscreen)document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen();else{const e=this._fsEl;if(!e)return;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}}_binToFreq(e){return e*this.audioCtx.sampleRate/this.fftSize||1}_calcBars(){const e=this._bars=[];if(!this._ready){this._flg={isAlpha:!1,isBands:!1,isLeds:!1,isLumi:!1,isOctaves:!1,isOutline:!1,isRound:!1,noLedGap:!1};return}const{_ansiBands:i,_barSpace:s,canvas:n,_chLayout:c,_maxFreq:r,_minFreq:o,_mirror:l,_mode:p,_radial:_,_radialInvert:g,_reflexRatio:x}=this,H=n.width>>1,j=n.height>>1,W=c==Re&&!_,U=c==Ye,M=p%10!=0,ne=M&&this._frequencyScale==Me,w=this._showLeds&&M&&!_,G=this._lumiBars&&M&&!_,ce=this._alphaBars&&!G&&p!=Ne,ee=this._outlineBars&&M&&!G&&!w,y=this._roundBars&&M&&!G&&!w,Q=c!=Re||x>0&&!G,z=n.height-(W&&!w?.5:0)>>W,Y=z*(G||_?1:1-x)|0,t=n.width-H*(U||l!=0),K=W?n.height-z*2:0,ue=H*(l==-1&&!U&&!_);let oe=Math.min(n.width,n.height)*.375*(c==Re?1:this._radius)|0,O=Math.min(H,j);g&&c!=Re&&([oe,O]=[O,oe]);const T=b=>e.push({...b,peak:[0,0],hold:[0],alpha:[0],value:[0]}),A=b=>{const B=this._freqToBin(b,"floor"),m=this._binToFreq(B),R=this._binToFreq(B+1),F=Math.log2(b/m)/Math.log2(R/m);return[B,F]};let u,q,v;if(ne){const b=(C,N,S)=>+C.toPrecision(S?Math.max(N,1+Math.log10(C)|0):N),B=C=>{const N=[1,1.12,1.25,1.4,1.6,1.8,2,2.24,2.5,2.8,3.15,3.55,4,4.5,5,5.6,6.3,7.1,8,9,10],S=Math.log10(C)|0,ge=C/10**S;let fe=1;for(;fe<N.length&&ge>N[fe];)fe++;return ge-N[fe-1]<N[fe]-ge&&fe--,(N[fe]*10**(S+5)|0)/1e5},m=[0,24,12,8,6,4,3,2,1][p],R=i?10**(3/(m*10)):2**(1/m),F=R**.5;let te=i?7.94328235/(m%2?1:F):pt;do{let C=te;const N=b(C/F,4,!0),S=b(C*F,4,!0),[ge,fe]=A(N),[Ge,pe]=A(S);i?C=m<4?B(C):b(C,C.toString()[0]<5?3:2):C=b(C,4,!0),C>=o&&T({posX:0,freq:C,freqLo:N,freqHi:S,binLo:ge,binHi:Ge,ratioLo:fe,ratioHi:pe}),te*=R}while(te<=r);u=t/e.length,e.forEach((C,N)=>C.posX=ue+N*u);const D=e[0],J=e[e.length-1];q=this._freqScaling(D.freqLo),v=t/(this._freqScaling(J.freqHi)-q),D.freqLo<o&&(D.freqLo=o,[D.binLo,D.ratioLo]=A(o)),J.freqHi>r&&(J.freqHi=r,[J.binHi,J.ratioHi]=A(r))}else if(M){const b=[0,24,12,8,6,4,3,2,1][p]*10,B=m=>{switch(this._frequencyScale){case ot:return 1960/(26.81/(m+.53)-1);case lt:return 700*(2**m-1);case Pe:return m}};u=t/b,q=this._freqScaling(o),v=t/(this._freqScaling(r)-q);for(let m=0,R=0;m<b;m++,R+=u){const F=B(q+R/v),te=B(q+(R+u/2)/v),D=B(q+(R+u)/v),[J,C]=A(F),[N,S]=A(D);T({posX:ue+R,freq:te,freqLo:F,freqHi:D,binLo:J,binHi:N,ratioLo:C,ratioHi:S})}}else{u=1,q=this._freqScaling(o),v=t/(this._freqScaling(r)-q);const b=this._freqToBin(o,"floor"),B=this._freqToBin(r);let m=-999;for(let R=b;R<=B;R++){const F=this._binToFreq(R),te=ue+Math.round(v*(this._freqScaling(F)-q));if(te>m)T({posX:te,freq:F,freqLo:F,freqHi:F,binLo:R,binHi:R,ratioLo:0,ratioHi:0}),m=te;else if(e.length){const D=e[e.length-1];D.binHi=R,D.freqHi=F,D.freq=(D.freqLo*F)**.5}}}let se=0,X=0;if(w){const b=this._pixelRatio/(window.devicePixelRatio>1&&window.screen.height<=540?2:1),B=[[],[128,3,.45],[128,4,.225],[96,6,.225],[80,6,.225],[80,6,.125],[64,6,.125],[48,8,.125],[24,16,.125]],m=this._ledParams,[R,F,te]=m||B[p];let D,J=Y;if(m){const C=2*b;let N;D=R+1;do D--,N=J/D/(1+F),X=N*F;while((N<C||X<C)&&D>1)}else{const C=540/F;X=Math.min(F*b,Math.max(2,J/C+.1|0))}Q&&(J+=X),m||(D=Math.min(R,J/(X*2)|0)),se=te>=1?te:u*te,this._leds=[D,se,X,J/D-X]}const E=Math.min(u-1,s*(s>0&&s<1?u:1));M&&(u-=Math.max(w?se:0,E)),e.forEach((b,B)=>{let m=b.posX,R=u;M&&(s==0&&!w?(m|=0,R|=0,B>0&&m>e[B-1].posX+e[B-1].width&&(m--,R++)):m+=Math.max(w?se:0,E)/2,b.posX=m),b.barCenter=m+(u==1?0:R/2),b.width=R});const de=[];for(const b of[0,1]){const B=c==Re?(z+K)*b:0,m=B+z,R=B+Y-(!w||Q?0:X);de.push({channelTop:B,channelBottom:m,analyzerBottom:R})}this._aux={analyzerHeight:Y,analyzerWidth:t,centerX:H,centerY:j,channelCoords:de,channelHeight:z,channelGap:K,initialX:ue,innerRadius:oe,outerRadius:O,scaleMin:q,unitWidth:v},this._flg={isAlpha:ce,isBands:M,isLeds:w,isLumi:G,isOctaves:ne,isOutline:ee,isRound:y,noLedGap:Q},this._createScales()}_createScales(){if(!this._ready)return;const{analyzerWidth:e,initialX:i,innerRadius:s,scaleMin:n,unitWidth:c}=this._aux,{canvas:r,_frequencyScale:o,_mirror:l,_noteLabels:p,_radial:_,_scaleX:g,_scaleR:x}=this,H=g.canvas,j=x.canvas,W=[],U=this._chLayout==Ye,M=this._chLayout==Re,ne=Math.min(r.width,r.height),w=["C",,"D",,"E","F",,"G",,"A",,"B"],G=ne/34|0,ce=H.height>>1,ee=G>>1,y=ce*(p?.7:1.5),Q=ee*(p?1:2),z=2**(1/12);if(!p&&(this._ansiBands||o!=Me))W.push(16,31.5,63,125,250,500,1e3,2e3,4e3),o==Pe?W.push(6e3,8e3,1e4,12e3,14e3,16e3,18e3,2e4,22e3):W.push(8e3,16e3);else{let O=pt;for(let T=-1;T<11;T++)for(let A=0;A<12;A++){if(O>=this._minFreq&&O<=this._maxFreq){const u=w[A],q=u=="C";(u&&p&&!l&&!U||q)&&W.push(p?[O,u+(q?T:"")]:O)}O*=z}}j.width=j.height=Math.max(ne*.15,(s<<1)+M*G);const Y=j.width>>1,t=Y-G*.7,K=(O,T)=>{const A=De*(O/r.width),u=A-nt,q=t*Math.cos(u),v=t*Math.sin(u);x.save(),x.translate(Y+q,Y+v),x.rotate(A),x.fillText(T,0,0),x.restore()};H.width|=0,g.fillStyle=x.strokeStyle=ei,g.fillRect(0,0,H.width,H.height),x.arc(Y,Y,Y-G/2,0,De),x.lineWidth=G,x.stroke(),g.fillStyle=x.fillStyle=Tt,g.font=`${ce}px ${$e}`,x.font=`${ee}px ${$e}`,g.textAlign=x.textAlign="center";let ue=-y/4,oe=-Q;for(const O of W){const[T,A]=Array.isArray(O)?O:[O,O<1e3?O|0:`${(O/100|0)/10}k`],u=c*(this._freqScaling(T)-n),q=H.height*.75,v=A[0]=="C",se=ce*(p&&!l&&!U?v?1.2:.6:3);if(g.fillStyle=x.fillStyle=v&&!l&&!U?ti:Tt,p){const X=o==Me,E=o==Pe;let de=["C"];if((X||T>2e3||!E&&T>250||(!_||M)&&(!E&&T>125||T>1e3))&&de.push("G"),(X||T>4e3||!E&&T>500||(!_||M)&&(!E&&T>250||T>2e3))&&de.push("E"),(E&&T>4e3||(!_||M)&&(X||T>2e3||!E&&T>500))&&de.push("D","F","A","B"),!de.includes(A[0]))continue}u>=ue+y/2&&u<=e&&(g.fillText(A,U&&l==-1?e-u:i+u,q,se),(U||l&&(u>y||l==1))&&g.fillText(A,U&&l!=1?e+u:(i||r.width)-u,q,se),ue=u+Math.min(se,g.measureText(A).width)/2),u>=oe+Q&&u<e-Q&&(K(U&&l==1?e-u:u,A),(U||l&&(u>Q||l==1))&&K(U&&l!=-1?e+u:-u,A),oe=u)}}_draw(e){this._runId=requestAnimationFrame(a=>this._draw(a));const i=e-this._time,s=e-this._last,n=this._maxFPS?975/this._maxFPS:0;if(s<n)return;this._last=e-(n?s%n:0),this._frames++,i>=1e3&&(this._fps=this._frames/i*1e3,this._frames=0,this._time=e);const{isAlpha:c,isBands:r,isLeds:o,isLumi:l,isOctaves:p,isOutline:_,isRound:g,noLedGap:x}=this._flg,{analyzerHeight:H,centerX:j,centerY:W,channelCoords:U,channelHeight:M,channelGap:ne,initialX:w,innerRadius:G,outerRadius:ce}=this._aux,{_bars:ee,canvas:y,_canvasGradients:Q,_chLayout:z,_colorMode:Y,_ctx:t,_energy:K,_fadePeaks:ue,fillAlpha:oe,_fps:O,_linearAmplitude:T,_lineWidth:A,maxDecibels:u,minDecibels:q,_mirror:v,_mode:se,overlay:X,_radial:E,showBgColor:de,showPeaks:b,useCanvas:B,_weightingFilter:m}=this,R=this._scaleX.canvas,F=this._scaleR.canvas,te=O*this._peakFadeTime/1e3,D=O**2,J=this._gravity*1e3,C=O*this._peakHoldTime/1e3,N=z==mt,S=z==Ye,ge=z==Re,fe=z==ye,Ge=o&&this._trueLeds&&Y==Qe,pe=E?y.width:this._aux.analyzerWidth,Ke=w+pe,He=b&&this._peakLine&&se==Ne,Ae=E?ce-G:H,Mt=Ae/this._pixelRatio,[Gt,gi,ze,Je]=this._leds||[];K.val>0&&O>0&&(this._spinAngle+=this._spinSpeed*De/60/O);const Ht=a=>{if(this._reflexRatio>0&&!l&&!E){let L,me;this.reflexFit||ge?(L=ge&&a==0?M+ne:0,me=M-H):(L=y.height-H*2,me=H),t.save(),t.globalAlpha=this.reflexAlpha,this.reflexBright!=1&&(t.filter=`brightness(${this.reflexBright})`),t.setTransform(1,0,0,-1,0,y.height),t.drawImage(y,0,U[a].channelTop,y.width,H,0,L,y.width,me),t.restore()}},zt=()=>{this.showScaleX&&(E?(t.save(),t.translate(j,W),this._spinSpeed&&t.rotate(this._spinAngle+nt),t.drawImage(F,-F.width>>1,-F.width>>1),t.restore()):t.drawImage(R,0,y.height-R.height))},qt=a=>{const L=a**2,me=424.36,$=11599.29,We=25122.25,Ee=544496.41,we=148693636,ve=xe=>20*Math.log10(xe);switch(m){case At:const xe=we*L**2/((L+me)*Math.sqrt((L+$)*(L+Ee))*(L+we));return 2+ve(xe);case Et:const Te=we*L*a/((L+me)*Math.sqrt(L+We)*(L+we));return .17+ve(Te);case St:const tt=we*L/((L+me)*(L+we));return .06+ve(tt);case bt:const Ue=((103791848e-2-L)**2+108076816e-2*L)/((9837328-L)**2+11723776*L),it=a/68966888496476e-18*Math.sqrt(Ue/((L+79919.29)*(L+1345600)));return ve(it);case Ct:const Ve=-4737338981378384e-39*a**6+2043828333606125e-30*a**4-1363894795463638e-22*L+1,Be=1306612257412824e-34*a**5-2118150887518656e-26*a**3+.0005559488023498642*a,re=.0001246332637532143*a/Math.hypot(Ve,Be);return 18.2+ve(re)}return 0},Ze=(a,L,me)=>{t.beginPath(),t.moveTo(a,L),t.lineTo(a,me),t.stroke()},et=a=>{if(a&&A){const L=t.globalAlpha;t.globalAlpha=1,t.stroke(),t.globalAlpha=L}},Ce=a=>Math.max(0,(a*Gt|0)*(Je+ze)-ze),Pt=a=>{K.val=a,K.peak>0&&(K.hold--,K.hold<0&&(K.peak+=K.hold*J/D/y.height*this._pixelRatio)),a>=K.peak&&(K.peak=a,K.hold=C)};X&&t.clearRect(0,0,y.width,y.height);let dt=0;const ft=ee.length,_t=fe?1:2;for(let a=0;a<_t;a++){const{channelTop:L,channelBottom:me,analyzerBottom:$}=U[a],We=this._gradients[this._selectedGrads[a]],Ee=We.colorStops,we=Ee.length,ve=!de||o&&!X?"#000":We.bgColor,xe=ge&&E&&a?-1:1,Te=!a&&v==-1||a&&v==1,tt=!S||a&&v!=1?0:pe>>(a||!Te),Ue=S&&Te?-1:1,it=()=>{const h=R.height,d=h>>1,f=T?100:u,k=T?0:q,P=T?20:5,ae=H/(f-k),Le=v!=-1&&(!S||a==0||v==1),Se=v!=1&&(!S||a!=v);t.save(),t.fillStyle=Bt,t.font=`${d}px ${$e}`,t.textAlign="right",t.lineWidth=1;for(let be=f;be>k;be-=P){const Oe=L+(f-be)*ae,V=be%2==0|0;if(V){const ie=Oe+d*(Oe==L?.8:.35);Le&&t.fillText(be,h*.85,ie),Se&&t.fillText(be,(S?pe:y.width)-h*.1,ie),t.strokeStyle=Bt,t.setLineDash([2,4]),t.lineDashOffset=0}else t.strokeStyle=ii,t.setLineDash([2,8]),t.lineDashOffset=1;t.beginPath(),t.moveTo(w+h*V*Le,~~Oe+.5),t.lineTo(Ke-h*V*Se,~~Oe+.5),t.stroke()}t.restore()},Ve=(h,d)=>{const f=_e[h]+(h<_e.length-1?(_e[h+1]-_e[h])*d:0);return isNaN(f)?-1/0:f},Be=(h,d=Ue)=>d*De*((h+tt)/y.width)+this._spinAngle,re=(h,d,f)=>{const k=G+d*xe,P=Be(h,f);return[j+k*Math.cos(P),W+k*Math.sin(P)]},st=(h,d,f,k,P)=>{t.beginPath();for(const ae of v&&!S?[1,-1]:[Ue]){const[Le,Se]=g?[Be(h,ae),Be(h+f,ae)]:[];t.moveTo(...re(h,d,ae)),t.lineTo(...re(h,d+k,ae)),g?t.arc(j,W,G+(d+k)*xe,Le,Se,ae!=1):t.lineTo(...re(h+f,d+k,ae)),t.lineTo(...re(h+f,d,ae)),g&&!P&&t.arc(j,W,G+d*xe,Se,Le,ae==1)}et(P),t.fill()},at=(h=0,d=0)=>{let f;if(Y==Qe&&!Ge||se==Ne)f=Q[a];else{const k=Y==Lt?d%we:Ee.findLastIndex(P=>o?Ce(h)<=Ce(P.level):h<=P.level);f=Ee[k].color}t.fillStyle=t.strokeStyle=f};if(B){if(S&&!E){const h=pe*(a+Te),d=Te?-1:1;t.setTransform(d,0,0,1,h,0)}if((!X||de)&&(X&&(t.globalAlpha=this.bgAlpha),t.fillStyle=ve,(a==0||!E&&!N)&&t.fillRect(w,L-ne,pe,(X&&this.reflexAlpha==1?H:M)+ne),t.globalAlpha=1),this.showScaleY&&!l&&!E&&(a==0||!N)&&it(),o?(t.setLineDash([Je,ze]),t.lineWidth=ee[0].width):t.lineWidth=_?Math.min(A,ee[0].width/2):A,t.save(),!E){const h=new Path2D;h.rect(0,L,y.width,H),t.clip(h)}}let _e=this._fftData[a];this._analyzer[a].getFloatFrequencyData(_e),m&&(_e=_e.map((h,d)=>h+qt(this._binToFreq(d)))),t.beginPath();let qe=[];for(let h=0;h<ft;h++){const d=ee[h],{posX:f,barCenter:k,width:P,freq:ae,binLo:Le,binHi:Se,ratioLo:be,ratioHi:Oe}=d;let V=Math.max(Ve(Le,be),Ve(Se,Oe));for(let I=Le+1;I<Se;I++)_e[I]>V&&(V=_e[I]);if(V=this._normalizedB(V),d.value[a]=V,dt+=V,d.peak[a]>0&&d.alpha[a]>0&&(d.hold[a]--,d.hold[a]<0)){if(ue&&!He){const I=!c||_&&A>0?1:c?d.peak[a]:oe;d.alpha[a]=I*(1+d.hold[a]/te)}else d.peak[a]+=d.hold[a]*J/D/Mt;d.alpha[a]<=0&&(d.peak[a]=0)}if(V>=d.peak[a]&&(d.peak[a]=V,d.hold[a]=C,d.alpha[a]=!c||_&&A>0?1:c?V:oe),!B)continue;t.globalAlpha=l||c?V:_?oe:1,at(V,h);const ie=l?Ae:o?Ce(V):V*Ae|0;if(se==Ne){const I=h?0:(this._normalizedB(_e[ee[1].binLo])*Ae+ie)/2;if(E){if(h==0&&(S&&t.moveTo(...re(0,0)),t.lineTo(...re(0,f<0?I:ie))),f>=0){const le=[f,ie];t.lineTo(...re(...le)),qe.push(le)}}else{if(h==0)if(v==-1&&!S)t.moveTo(w,$-(f<w?I:ie));else{const le=Le?this._normalizedB(_e[Le-1])*Ae:ie;t.moveTo(w-A,$-le)}(S||v!=-1||f>=w)&&t.lineTo(f,$-ie)}}else if(o){if(de&&!X&&(a==0||!N)){const I=t.globalAlpha;t.strokeStyle=Kt,t.globalAlpha=1,Ze(k,L,$),t.strokeStyle=t.fillStyle,t.globalAlpha=I}if(Ge){const I=l?0:Ee.findLastIndex(Ie=>Ce(V)<=Ce(Ie.level));let le=$;for(let Ie=we-1;Ie>=I;Ie--){t.strokeStyle=Ee[Ie].color;let gt=$-(Ie==I?ie:Ce(Ee[Ie].level));Ze(k,le,gt),le=gt-ze}}else Ze(k,$,$-ie)}else if(f>=w)if(E)st(f,0,P,ie,_);else if(g){const I=P/2,le=$+I;t.beginPath(),t.moveTo(f,le),t.lineTo(f,le-ie),t.arc(k,le-ie,I,ct,De),t.lineTo(f+P,le),et(_),t.fill()}else{const I=_?t.lineWidth:0;t.beginPath(),t.rect(f,$+I,P,-ie-I),et(_),t.fill()}const ke=d.peak[a],ut=d.alpha[a];if(ke>0&&ut>0&&b&&!He&&!l&&f>=w&&f<Ke){if(ue?t.globalAlpha=ut:_&&A>0?t.globalAlpha=1:c&&(t.globalAlpha=ke),(Y==Rt||Ge)&&at(ke),o){const I=Ce(ke);I>=ze&&t.fillRect(f,$-I,P,Je)}else if(!E)t.fillRect(f,$-ke*Ae,P,2);else if(se!=Ne){const I=ke*Ae;st(f,I,P,!this._radialInvert||ge||I+G>=2?-2:2)}}}if(B){if(t.globalAlpha=1,se==Ne){if(at(),E&&!S){if(v){let h;for(;h=qe.pop();)t.lineTo(...re(...h,-1))}t.closePath()}if(A>0&&t.stroke(),oe>0){if(E){const h=S?Be(pe>>1):0,d=S?Be(pe):De;t.moveTo(...re(S?pe>>1:0,0)),t.arc(j,W,G,h,d,S?!Te:!0)}else t.lineTo(Ke,$),t.lineTo(w,$);t.globalAlpha=oe,t.fill(),t.globalAlpha=1}if((He||E&&b)&&(qe=[],t.beginPath(),ee.forEach((h,d)=>{let f=h.posX,k=h.peak[a],P=d?"lineTo":"moveTo";if(E&&f<0){const ae=ee[d+1];k=fi(f,k,ae.posX,ae.peak[a],0),f=0}k*=Ae,He?(t[P](...E?re(f,k):[f,$-k]),E&&v&&!S&&qe.push([f,k])):k>0&&st(f,k,1,-2)}),He)){let h;for(;h=qe.pop();)t.lineTo(...re(...h,-1));t.lineWidth=1,t.stroke()}}t.restore(),S&&!E&&t.setTransform(1,0,0,1,0,0),(!S&&!N||a)&&Ht(a)}}if(Pt(dt/(ft<<_t-1)),B&&(v&&!E&&!S&&(t.setTransform(-1,0,0,1,y.width-w,0),t.drawImage(y,w,0,j,y.height,0,0,j,y.height),t.setTransform(1,0,0,1,0,0)),t.setLineDash([]),zt()),this.showFPS){const a=R.height;t.font=`bold ${a}px ${$e}`,t.fillStyle=Qt,t.textAlign="right",t.fillText(Math.round(O),y.width-a,a*2)}this.onCanvasDraw&&(t.save(),t.fillStyle=t.strokeStyle=Q[0],this.onCanvasDraw(this,{timestamp:e,canvasGradients:Q}),t.restore())}_freqScaling(e){switch(this._frequencyScale){case Me:return Math.log2(e);case ot:return 26.81*e/(1960+e)-.53;case lt:return Math.log2(1+e/700);case Pe:return e}}_freqToBin(e,i="round"){const s=this._analyzer[0].frequencyBinCount-1,n=Math[i](e*this.fftSize/this.audioCtx.sampleRate);return n<s?n:s}_makeGrad(){if(!this._ready)return;const{canvas:e,_ctx:i,_radial:s,_reflexRatio:n}=this,{analyzerWidth:c,centerX:r,centerY:o,initialX:l,innerRadius:p,outerRadius:_}=this._aux,{isLumi:g}=this._flg,x=this._chLayout==Re,H=1-n,j=g?e.height:e.height*(1-n*!x)|0;for(const W of[0,1]){const U=this._gradients[this._selectedGrads[W]],M=U.colorStops,ne=U.dir=="h";let w;if(s?w=i.createRadialGradient(r,o,_,r,o,p-(_-p)*x):w=i.createLinearGradient(...ne?[l,0,l+c,0]:[0,0,0,j]),M){const G=x&&!this._splitGradient&&(!ne||s);for(let ce=0;ce<1+G;ce++){const ee=M.length-1;M.forEach((y,Q)=>{let z=y.pos;if(G&&(z/=2),x&&!g&&!s&&!ne&&(z*=H,!G&&z>.5*H&&(z+=.5*n)),ce==1)if(s||g){const Y=ee-Q;y=M[Y],z=1-y.pos/2}else Q==0&&z>0&&w.addColorStop(.5,y.color),z+=.5;w.addColorStop(z,y.color),x&&Q==ee&&z<.5&&w.addColorStop(.5,y.color)})}}this._canvasGradients[W]=w}}_normalizedB(e){const i=this._linearAmplitude,s=i?1/this._linearBoost:1,n=(l,p,_)=>l<=p?p:l>=_?_:l,c=l=>10**(l/20);let r=this.maxDecibels,o=this.minDecibels;return i&&(r=c(r),o=c(o),e=c(e)**s),n((e-o)/(r-o)**s,0,1)}_setCanvas(e){if(!this._ready)return;const{canvas:i,_ctx:s}=this,n=this._scaleX.canvas,c=window.devicePixelRatio/(this._loRes+1);let r=window.screen.width*c,o=window.screen.height*c;Math.abs(window.orientation)==90&&r<o&&([r,o]=[o,r]);const l=this.isFullscreen,p=l&&this._fsEl==i,_=p?r:(this._width||this._container.clientWidth||this._defaultWidth)*c|0,g=p?o:(this._height||this._container.clientHeight||this._defaultHeight)*c|0;this._pixelRatio=c,this._fsWidth=r,this._fsHeight=o,!(e!=vt&&i.width==_&&i.height==g)&&(i.width=_,i.height=g,this.overlay||(s.fillStyle="#000",s.fillRect(0,0,_,g)),s.lineJoin="bevel",n.width=_,n.height=Math.max(20*c,Math.min(_,g)/32|0),this._calcBars(),this._makeGrad(),this._fsStatus!==void 0&&this._fsStatus!==l&&(e=xt),this._fsStatus=l,this.onCanvasResize&&this.onCanvasResize(e,this))}_setGradient(e,i){if(!this._gradients.hasOwnProperty(e))throw new he(ni,e);[0,1].includes(i)||(this._selectedGrads[1]=e,i=0),this._selectedGrads[i]=e,this._makeGrad()}_setProps(e,i){const s=["onCanvasDraw","onCanvasResize"],n=["gradientLeft","gradientRight","stereo"],c=Object.keys(Xe).filter(r=>r!="start").concat(s,n);(i||e===void 0)&&(e={...Xe,...e});for(const r of Object.keys(e))s.includes(r)&&typeof e[r]!="function"?this[r]=void 0:c.includes(r)&&(this[r]=e[r]);e.start!==void 0&&this.toggleAnalyzer(e.start)}}const ui=Vt.div`
    max-width: 100%;
    margin: auto;

    canvas {
        width: 100%;
        margin: auto;
    }
`,mi=()=>{const{webAudio:Z}=Xt(),e=Fe.createRef(),i=Wt(l=>l.general.accent),[s,n]=Fe.useState(),[c,r]=Fe.useState(500);Fe.useEffect(()=>{const{context:l,gain:p}=Z||{};if(p&&l&&e.current&&!s){const _=new _i(e.current,{ansiBands:!0,audioCtx:l,connectSpeakers:!1,gradient:"prism",mode:4,overlay:!0,showBgColor:!1,showPeaks:!1,smoothing:.8});n(_),_.connectInput(p)}return()=>{}},[i,e,s,Z]);const o=Fe.useCallback(()=>{const l=document.querySelector(".full-screen-player-queue-container"),p=document.querySelector(".full-screen-player-queue-header");if(l&&p){const _=l.clientWidth-30,g=l.clientHeight-p.clientHeight-30;r(Math.min(_,g))}},[]);return Fe.useEffect(()=>(o(),window.addEventListener("resize",o),()=>{window.removeEventListener("resize",o)}),[o]),Ut.jsx(ui,{ref:e,style:{height:c,width:c}})};export{mi as Visualizer};
//# sourceMappingURL=visualizer-CSn7ivQY.js.map
