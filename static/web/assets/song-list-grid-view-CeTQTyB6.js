import{y as w,z as _,ac as z,u as B,d as F,l as Y,aa as j,r as d,cK as v,af as t,cL as r,q as C,bj as K,j as E,aH as M,cv as Q,cw as U,aU as V,n as H,e as $}from"./index-qz_z9GmZ.js";import{u as W}from"./use-handle-favorite-DgTaOWZK.js";const Z=({gridRef:y,itemCount:A})=>{const m=w(),s=_(),O=z(),{customFilters:S,id:i,pageKey:h}=B(),{display:L,filter:f,grid:o}=F({key:h}),{setGrid:D}=Y(),[R,k]=j(),x=R.get("scrollOffset"),g=Number(i?x:o==null?void 0:o.scrollOffset)||0,T=W({gridRef:y,server:s});d.useEffect(()=>{const e=v.subscribe(a=>{var l;const n=a.event;if(n&&n.event==="favorite"){const p=new Set(a.ids),c=n.favorite;(l=y.current)==null||l.updateItemData(u=>p.has(u.id)?{...u,userFavorite:c}:u)}});return()=>{e()}},[y]);const P=d.useMemo(()=>{const e=[r.name,r.album,r.albumArtists];switch(f.sortBy){case t.ALBUM:break;case t.ARTIST:break;case t.DURATION:e.push(r.duration);break;case t.FAVORITED:break;case t.NAME:break;case t.PLAY_COUNT:e.push(r.playCount);break;case t.RANDOM:break;case t.RATING:e.push(r.rating);break;case t.RECENTLY_ADDED:e.push(r.createdAt);break;case t.RECENTLY_PLAYED:e.push(r.lastPlayedAt);break;case t.YEAR:e.push(r.releaseYear);break;case t.RELEASE_DATE:e.push(r.releaseDate)}return e},[f.sortBy]),G=d.useCallback(e=>{i?k(a=>(a.set("scrollOffset",String(e.scrollOffset)),a),{replace:!0}):D({data:{scrollOffset:e.scrollOffset},key:h})},[i,h,D,k]),N=d.useCallback(()=>{const e={...f,...S},a=C.songs.list((s==null?void 0:s.id)||"",e,i),n=m.getQueriesData({exact:!1,fetchStatus:"idle",queryKey:a,stale:!1}),l=[];for(const[,p]of n){const{items:c,startIndex:u}=p||{};if(c&&c.length!==1&&u!==void 0){let I=0;for(let b=u;b<u+c.length;b+=1)l[b]=c[I],I+=1}}return l},[S,f,i,m,s==null?void 0:s.id]),q=d.useCallback(async({skip:e,take:a})=>{if(!s)return[];const n={imageSize:250,limit:a,...f,...S,startIndex:e},l=C.songs.list((s==null?void 0:s.id)||"",n,i);return await m.fetchQuery(l,async({signal:c})=>K.getSongList({apiClientProps:{server:s,signal:c},query:n}))},[S,f,i,m,s]);return E.jsx(M,{children:E.jsx(Q,{children:({height:e,width:a})=>E.jsx(U,{cardRows:P,display:L||$.CARD,fetchFn:q,fetchInitialData:N,handleFavorite:T,handlePlayQueueAdd:O,height:e,initialScrollOffset:g,itemCount:A||0,itemGap:(o==null?void 0:o.itemGap)??10,itemSize:(o==null?void 0:o.itemSize)||200,itemType:H.SONG,loading:A==null,minimumBatchSize:40,onScroll:G,ref:y,route:{route:V.LIBRARY_ALBUMS_DETAIL,slugs:[{idProperty:"albumId",slugProperty:"albumId"}]},width:a},`song-list-${s==null?void 0:s.id}-${L}`)})})};export{Z as SongListGridView};
//# sourceMappingURL=song-list-grid-view-CeTQTyB6.js.map
