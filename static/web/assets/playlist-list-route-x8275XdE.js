const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./playlist-list-table-view-DbjQyROP.js","./index-qz_z9GmZ.js","./index.css","./use-virtual-table-BjhVw3T4.js","./playlist-list-grid-view-C7D27PQd.js","./use-handle-favorite-DgTaOWZK.js"])))=>i.map(i=>d[i]);
import{u as ee,d as U,j as e,r as y,e as P,S as he,_ as te,i as se,y as xe,z as V,l as fe,B as ae,b3 as d,H as m,m as l,q as R,h as W,n as B,J as ne,t as F,K as r,M as _,D as N,O as je,U as Y,W as Pe,a0 as ge,a1 as J,s as re,a2 as Se,b4 as Te,T as Oe,v as ve,a6 as be,o as Le,P as Ae,L as X,a as Z,w as we,b5 as ke,a8 as De,a4 as Ie,I as Ee,b6 as _e,aM as Fe,ab as Me,b7 as Re,A as Ne,ae as ze}from"./index-qz_z9GmZ.js";const Be=y.lazy(()=>te(()=>import("./playlist-list-table-view-DbjQyROP.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(o=>({default:o.PlaylistListTableView}))),Ue=y.lazy(()=>te(()=>import("./playlist-list-grid-view-C7D27PQd.js"),__vite__mapDeps([4,1,2,5]),import.meta.url).then(o=>({default:o.PlaylistListGridView}))),Ve=({gridRef:o,itemCount:c,tableRef:n})=>{const{pageKey:a}=ee(),{display:u}=U({key:a});return e.jsxs(y.Suspense,{fallback:e.jsx(he,{container:!0}),children:[u===P.CARD||u===P.POSTER?e.jsx(Ue,{gridRef:o,itemCount:c}):e.jsx(Be,{itemCount:c,tableRef:n}),e.jsx("div",{})]})},z={jellyfin:[{defaultOrder:l.DESC,name:m.t("filter.duration",{postProcess:"titleCase"}),value:d.DURATION},{defaultOrder:l.ASC,name:m.t("filter.name",{postProcess:"titleCase"}),value:d.NAME},{defaultOrder:l.DESC,name:m.t("filter.songCount",{postProcess:"titleCase"}),value:d.SONG_COUNT}],navidrome:[{defaultOrder:l.DESC,name:m.t("filter.duration",{postProcess:"titleCase"}),value:d.DURATION},{defaultOrder:l.ASC,name:m.t("filter.name",{postProcess:"titleCase"}),value:d.NAME},{defaultOrder:l.ASC,name:m.t("filter.owner",{postProcess:"titleCase"}),value:d.OWNER},{defaultOrder:l.DESC,name:m.t("filter.isPublic",{postProcess:"titleCase"}),value:d.PUBLIC},{defaultOrder:l.DESC,name:m.t("filter.songCount",{postProcess:"titleCase"}),value:d.SONG_COUNT},{defaultOrder:l.DESC,name:m.t("filter.recentlyUpdated",{postProcess:"titleCase"}),value:d.UPDATED_AT}],subsonic:[{defaultOrder:l.DESC,name:m.t("filter.duration",{postProcess:"titleCase"}),value:d.DURATION},{defaultOrder:l.ASC,name:m.t("filter.name",{postProcess:"titleCase"}),value:d.NAME},{defaultOrder:l.ASC,name:m.t("filter.owner",{postProcess:"titleCase"}),value:d.OWNER},{defaultOrder:l.DESC,name:m.t("filter.isPublic",{postProcess:"titleCase"}),value:d.PUBLIC},{defaultOrder:l.DESC,name:m.t("filter.songCount",{postProcess:"titleCase"}),value:d.SONG_COUNT},{defaultOrder:l.DESC,name:m.t("filter.recentlyUpdated",{postProcess:"titleCase"}),value:d.UPDATED_AT}]},Ge=({gridRef:o,tableRef:c})=>{var K;const{t:n}=se(),{pageKey:a}=ee(),u=xe(),s=V(),{setDisplayType:v,setFilter:g,setGrid:L,setTable:h,setTablePagination:b}=fe(),{display:x,filter:p,grid:S,table:A}=U({key:a}),le=ae(),O=x===P.CARD||x===P.POSTER,ie=(s==null?void 0:s.type)&&((K=z[s.type].find(t=>t.value===p.sortBy))==null?void 0:K.name)||"Unknown",G=y.useCallback(async(t,i,f)=>{var E,T;const j={_custom:{jellyfin:{...(E=f._custom)==null?void 0:E.jellyfin},navidrome:{...(T=f._custom)==null?void 0:T.navidrome}},limit:i,startIndex:t,...f},C=R.playlists.list((s==null?void 0:s.id)||"",j);return await u.fetchQuery(C,async({signal:w})=>W.controller.getPlaylistList({apiClientProps:{server:s,signal:w},query:j}))},[u,s]),D=y.useCallback(async t=>{var i,f,j,C,I,E;if(O){(i=o.current)==null||i.scrollTo(0),(f=o.current)==null||f.resetLoadMoreItemsCache();const T=await G(0,200,t||p);if(!(T!=null&&T.items))return;(j=o.current)==null||j.setItemData(T.items)}else{const T={getRows:async w=>{const H=w.endRow-w.startRow,Q=w.startRow,$=t||p,Ce=R.playlists.list((s==null?void 0:s.id)||"",{limit:H,startIndex:Q,...$}),k=await u.fetchQuery(Ce,async({signal:ye})=>W.controller.getPlaylistList({apiClientProps:{server:s,signal:ye},query:{limit:H,startIndex:Q,...$}}));w.successCallback((k==null?void 0:k.items)||[],(k==null?void 0:k.totalRecordCount)||0)},rowCount:void 0};(C=c.current)==null||C.api.setDatasource(T),(I=c.current)==null||I.api.purgeInfiniteCache(),(E=c.current)==null||E.api.ensureIndexVisible(0,"top"),b({data:{currentPage:0},key:a})}},[O,o,G,p,c,b,a,s,u]),oe=y.useCallback(t=>{var j,C;if(!((j=t.currentTarget)!=null&&j.value)||!(s!=null&&s.type))return;const i=(C=z[s.type].find(I=>I.value===t.currentTarget.value))==null?void 0:C.defaultOrder,f=g({data:{sortBy:t.currentTarget.value,sortOrder:i||l.ASC},itemType:B.PLAYLIST,key:a});D(f)},[D,a,s==null?void 0:s.type,g]),ce=y.useCallback(()=>{const t=p.sortOrder===l.ASC?l.DESC:l.ASC,i=g({data:{sortOrder:t},itemType:B.PLAYLIST,key:a});D(i)},[p.sortOrder,D,a,g]),M=y.useCallback(t=>{var i;(i=t.currentTarget)!=null&&i.value&&v({data:t.currentTarget.value,key:a})},[a,v]),de=t=>{const i=A.columns;if(t.length===0)return h({data:{columns:[]},key:a});if(t.length>i.length){const C={column:t[t.length-1],width:100};return h({data:{columns:[...i,C]},key:a})}const f=i.filter(C=>!t.includes(C.column)),j=i.filter(C=>!f.includes(C));return h({data:{columns:j},key:a})},ue=t=>{var i;h({data:{autoFit:t.currentTarget.checked},key:a}),t.currentTarget.checked&&((i=c.current)==null||i.api.sizeColumnsToFit())},pe=t=>{O?L({data:{itemSize:t},key:a}):h({data:{rowHeight:t},key:a})},me=t=>{L({data:{itemGap:t},key:a})},q=()=>{u.invalidateQueries(R.playlists.list((s==null?void 0:s.id)||"",p)),D(p)};return e.jsxs(ne,{justify:"space-between",children:[e.jsxs(F,{ref:le.ref,spacing:"sm",w:"100%",children:[e.jsxs(r,{position:"bottom-start",children:[e.jsx(r.Target,{children:e.jsx(_,{compact:!0,fw:"600",size:"md",variant:"subtle",children:ie})}),e.jsx(r.Dropdown,{children:z[s==null?void 0:s.type].map(t=>e.jsx(r.Item,{$isActive:t.value===p.sortBy,onClick:oe,value:t.value,children:t.name},`filter-${t.name}`))})]}),e.jsx(N,{orientation:"vertical"}),e.jsx(je,{onToggle:ce,sortOrder:p.sortOrder}),e.jsx(N,{orientation:"vertical"}),e.jsx(_,{compact:!0,onClick:q,size:"md",tooltip:{label:n("common.refresh",{postProcess:"titleCase"})},variant:"subtle",children:e.jsx(Y,{size:"1.3rem"})}),e.jsx(N,{orientation:"vertical"}),e.jsxs(r,{position:"bottom-start",children:[e.jsx(r.Target,{children:e.jsx(_,{compact:!0,fw:"600",size:"md",variant:"subtle",children:e.jsx(Pe,{size:"1.3rem"})})}),e.jsx(r.Dropdown,{children:e.jsx(r.Item,{icon:e.jsx(Y,{}),onClick:q,children:n("common.refresh",{postProcess:"titleCase"})})})]})]}),e.jsx(F,{children:e.jsxs(r,{position:"bottom-end",width:425,children:[e.jsx(r.Target,{children:e.jsx(_,{compact:!0,size:"md",variant:"subtle",children:e.jsx(ge,{size:"1.3rem"})})}),e.jsxs(r.Dropdown,{children:[e.jsx(r.Label,{children:n("table.config.general.displayType",{postProcess:"sentenceCase"})}),e.jsx(r.Item,{$isActive:x===P.CARD,onClick:M,value:P.CARD,children:n("table.config.view.card",{postProcess:"titleCase"})}),e.jsx(r.Item,{$isActive:x===P.POSTER,onClick:M,value:P.POSTER,children:n("table.config.view.poster",{postProcess:"titleCase"})}),e.jsx(r.Item,{$isActive:x===P.TABLE,onClick:M,value:P.TABLE,children:n("table.config.view.table",{postProcess:"titleCase"})}),e.jsx(r.Divider,{}),e.jsx(r.Label,{children:n("table.config.general.itemSize",{postProcess:"sentenceCase"})}),e.jsx(r.Item,{closeMenuOnClick:!1,children:e.jsx(J,{defaultValue:O?(S==null?void 0:S.itemSize)||0:A.rowHeight,max:O?300:100,min:O?100:25,onChangeEnd:pe})}),O&&e.jsxs(e.Fragment,{children:[e.jsx(r.Label,{children:n("table.config.general.itemGap",{postProcess:"sentenceCase"})}),e.jsx(r.Item,{closeMenuOnClick:!1,children:e.jsx(J,{defaultValue:(S==null?void 0:S.itemGap)||0,max:30,min:0,onChangeEnd:me})})]}),!O&&e.jsxs(e.Fragment,{children:[e.jsx(r.Label,{children:n("table.config.generaltableColumns",{postProcess:"titleCase"})}),e.jsx(r.Item,{closeMenuOnClick:!1,component:"div",sx:{cursor:"default"},children:e.jsxs(re,{children:[e.jsx(Se,{clearable:!0,data:Te,defaultValue:A==null?void 0:A.columns.map(t=>t.column),onChange:de,width:300}),e.jsxs(F,{position:"apart",children:[e.jsx(Oe,{children:n("table.config.general.autoFitColumns",{postProcess:"titleCase"})}),e.jsx(ve,{defaultChecked:A.autoFit,onChange:ue})]})]})})]})]})]})})]})},qe=({gridRef:o,itemCount:c,tableRef:n})=>{const{t:a}=se(),u=ae(),s=V(),v=()=>{var x;Ie({children:e.jsx(_e,{onCancel:()=>Fe()}),onClose:()=>{var p,S;(S=(p=n==null?void 0:n.current)==null?void 0:p.api)==null||S.purgeInfiniteCache()},size:(s==null?void 0:s.type)===((x=Ee)==null?void 0:x.NAVIDROME)?"xl":"sm",title:a("form.createPlaylist.title",{postProcess:"sentenceCase"})})},{filter:g,refresh:L,search:h}=be({gridRef:o,itemCount:c,itemType:B.PLAYLIST,server:s,tableRef:n}),b=Le(x=>{const p=h(x);L(p)},500);return e.jsxs(re,{ref:u.ref,spacing:0,children:[e.jsx(Ae,{backgroundColor:"var(--titlebar-bg)",children:e.jsxs(ne,{align:"center",justify:"space-between",w:"100%",children:[e.jsxs(X,{children:[e.jsx(X.Title,{children:a("page.playlistList.title",{postProcess:"titleCase"})}),e.jsx(Z,{fw:"600",px:"1rem",py:"0.3rem",radius:"sm",children:c??e.jsx(we,{})}),e.jsx(_,{onClick:v,tooltip:{label:a("action.createPlaylist",{postProcess:"sentenceCase"}),openDelay:500},variant:"filled",children:e.jsx(ke,{})})]}),e.jsx(F,{children:e.jsx(De,{defaultValue:g.searchTerm,onChange:b,openedWidth:u.isMd?250:u.isSm?200:150})})]})}),e.jsx(Z,{p:"1rem",children:e.jsx(Ge,{gridRef:o,tableRef:n})})]})},He=()=>{var h,b;const o=y.useRef(null),c=y.useRef(null),n=V(),{playlistId:a}=Me(),u="playlist",{filter:s}=U({key:u}),v=Re({options:{cacheTime:1e3*60*60*2,staleTime:1e3*60*60*2},query:{...s,limit:1,sortBy:d.NAME,sortOrder:l.ASC,startIndex:0},serverId:n==null?void 0:n.id}),g=((h=v.data)==null?void 0:h.totalRecordCount)===null||(b=v.data)==null?void 0:b.totalRecordCount,L=y.useMemo(()=>({id:a,pageKey:u}),[a]);return e.jsx(Ne,{children:e.jsxs(ze.Provider,{value:L,children:[e.jsx(qe,{gridRef:o,itemCount:g,tableRef:c}),e.jsx(Ve,{gridRef:o,itemCount:g,tableRef:c})]})})};export{He as default};
//# sourceMappingURL=playlist-list-route-x8275XdE.js.map
