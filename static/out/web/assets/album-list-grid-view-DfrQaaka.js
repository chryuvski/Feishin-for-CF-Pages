import{y as B,z as M,ac as U,u as q,d as w,l as F,aa as g,r as A,F as a,cJ as e,q as T,bj as j,j as y,aH as z,cv as K,cw as Q,aU as V,n as H,e as $}from"./index-qz_z9GmZ.js";import{u as J}from"./use-handle-favorite-DgTaOWZK.js";const Z=({gridRef:S,itemCount:h})=>{const o=B(),t=M(),D=U(),{customFilters:n,id:l,pageKey:b}=q(),{display:L,filter:i,grid:r}=w({key:b}),{setGrid:k}=F(),[E,C]=g(),O=E.get("scrollOffset"),x=Number(l?O:r==null?void 0:r.scrollOffset)||0,Y=J({gridRef:S,server:t}),N=A.useMemo(()=>{const s=[e.name];switch(i.sortBy){case a.ALBUM_ARTIST:s.push(e.albumArtists),s.push(e.releaseYear);break;case a.ARTIST:s.push(e.artists),s.push(e.releaseYear);break;case a.COMMUNITY_RATING:s.push(e.albumArtists);break;case a.DURATION:s.push(e.albumArtists),s.push(e.duration);break;case a.FAVORITED:s.push(e.albumArtists),s.push(e.releaseYear);break;case a.NAME:s.push(e.albumArtists),s.push(e.releaseYear);break;case a.PLAY_COUNT:s.push(e.albumArtists),s.push(e.playCount);break;case a.RANDOM:s.push(e.albumArtists),s.push(e.releaseYear);break;case a.RATING:s.push(e.albumArtists),s.push(e.rating);break;case a.RECENTLY_ADDED:s.push(e.albumArtists),s.push(e.createdAt);break;case a.RECENTLY_PLAYED:s.push(e.albumArtists),s.push(e.lastPlayedAt);break;case a.SONG_COUNT:s.push(e.albumArtists),s.push(e.songCount);break;case a.YEAR:s.push(e.albumArtists),s.push(e.releaseYear);break;case a.RELEASE_DATE:s.push(e.albumArtists),s.push(e.releaseDate)}return s},[i.sortBy]),P=A.useCallback(s=>{l?C(u=>(u.set("scrollOffset",String(s.scrollOffset)),u),{replace:!0}):k({data:{scrollOffset:s.scrollOffset},key:b})},[l,b,k,C]),_=A.useCallback(()=>{const s={...i,...n},u=T.albums.list((t==null?void 0:t.id)||"",s,l),p=o.getQueriesData({exact:!1,fetchStatus:"idle",queryKey:u,stale:!1}),m=[];for(const[,R]of p){const{items:c,startIndex:d}=R||{};if(c&&c.length!==1&&d!==void 0){let I=0;for(let f=d;f<d+c.length;f+=1)m[f]=c[I],I+=1}}return m},[n,i,l,o,t==null?void 0:t.id]),G=A.useCallback(async({skip:s,take:u})=>{if(!t)return[];const p={limit:u,...i,...n,startIndex:s},m=T.albums.list((t==null?void 0:t.id)||"",p,l);return await o.fetchQuery(m,async({signal:c})=>j.getAlbumList({apiClientProps:{server:t,signal:c},query:p}))},[n,i,l,o,t]);return y.jsx(z,{children:y.jsx(K,{children:({height:s,width:u})=>y.jsx(Q,{cardRows:N,display:L||$.CARD,fetchFn:G,fetchInitialData:_,handleFavorite:Y,handlePlayQueueAdd:D,height:s,initialScrollOffset:x,itemCount:h||0,itemGap:(r==null?void 0:r.itemGap)??10,itemSize:(r==null?void 0:r.itemSize)||200,itemType:H.ALBUM,loading:h==null,minimumBatchSize:40,onScroll:P,ref:S,route:{route:V.LIBRARY_ALBUMS_DETAIL,slugs:[{idProperty:"id",slugProperty:"albumId"}]},width:u},`album-list-${t==null?void 0:t.id}-${L}`)})})};export{Z as AlbumListGridView};
//# sourceMappingURL=album-list-grid-view-DfrQaaka.js.map
